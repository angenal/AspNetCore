(function(n,t){typeof define=="function"&&define.amd?define("simple-module",["jquery"],function(i){return n.Module=t(i)}):typeof exports=="object"?module.exports=t(require("jquery")):n.SimpleModule=t(jQuery)})(this,function(n){var t=[].slice;return function(){function i(t){var e,i,r,u,f,o,s;if(this.opts=n.extend({},this.opts,t),(e=this.constructor)._connectedClasses||(e._connectedClasses=[]),f=function(){var n,u,t,r;for(t=this.constructor._connectedClasses,r=[],n=0,u=t.length;n<u;n++)i=t[n],s=i.pluginName.charAt(0).toLowerCase()+i.pluginName.slice(1),i.prototype._connected&&(i.prototype._module=this),r.push(this[s]=new i);return r}.call(this),this._connected)this.opts=n.extend({},this.opts,this._module.opts);else for(this._init(),r=0,o=f.length;r<o;r++)u=f[r],typeof u._init=="function"&&u._init();this.trigger("initialized")}return i.extend=function(n){var t,i,r;if(n!=null&&typeof n=="object"){for(t in n)r=n[t],t!=="included"&&t!=="extended"&&(this[t]=r);if((i=n.extended)!=null)return i.call(this)}},i.include=function(n){var t,i,r;if(n!=null&&typeof n=="object"){for(t in n)r=n[t],t!=="included"&&t!=="extended"&&(this.prototype[t]=r);if((i=n.included)!=null)return i.call(this)}},i.connect=function(n){if(typeof n=="function"){if(!n.pluginName)throw new Error("Module.connect: cannot connect plugin without pluginName");return n.prototype._connected=!0,this._connectedClasses||(this._connectedClasses=[]),this._connectedClasses.push(n),n.pluginName?this[n.pluginName]=n:void 0}},i.prototype.opts={},i.prototype._init=function(){},i.prototype.on=function(){var i,r;return i=1<=arguments.length?t.call(arguments,0):[],(r=n(this)).on.apply(r,i),this},i.prototype.one=function(){var i,r;return i=1<=arguments.length?t.call(arguments,0):[],(r=n(this)).one.apply(r,i),this},i.prototype.off=function(){var i,r;return i=1<=arguments.length?t.call(arguments,0):[],(r=n(this)).off.apply(r,i),this},i.prototype.trigger=function(){var i,r;return i=1<=arguments.length?t.call(arguments,0):[],(r=n(this)).trigger.apply(r,i),this},i.prototype.triggerHandler=function(){var i,r;return i=1<=arguments.length?t.call(arguments,0):[],(r=n(this)).triggerHandler.apply(r,i)},i.prototype._t=function(){var n,i;return n=1<=arguments.length?t.call(arguments,0):[],(i=this.constructor)._t.apply(i,n)},i._t=function(){var i,r,u,n;return(r=arguments[0],i=2<=arguments.length?t.call(arguments,1):[],n=((u=this.i18n[this.locale])!=null?u[r]:void 0)||"",!(i.length>0))?n:(n=n.replace(/([^%]|^)%(?:(\d+)\$)?s/g,function(n,t,r){return r?t+i[parseInt(r)-1]:t+i.shift()}),n.replace(/%%s/g,"%s"))},i.i18n={"zh-CN":{}},i.locale="zh-CN",i}()}),function(n,t){typeof define=="function"&&define.amd?define("simple-hotkeys",["jquery","simple-module"],function(i,r){return n.hotkeys=t(i,r)}):typeof exports=="object"?module.exports=t(require("jquery"),require("simple-module")):(n.simple=n.simple||{},n.simple.hotkeys=t(jQuery,SimpleModule))}(this,function(n,t){var i,r=function(n,t){function r(){this.constructor=n}for(var i in t)u.call(t,i)&&(n[i]=t[i]);return r.prototype=t.prototype,n.prototype=new r,n.__super__=t.prototype,n},u={}.hasOwnProperty;return i=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return r(i,t),i.count=0,i.keyNameMap={8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",91:"Meta",93:"Meta",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"Multiply",107:"Add",109:"Subtract",110:"Decimal",111:"Divide",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",124:"F13",125:"F14",126:"F15",127:"F16",128:"F17",129:"F18",130:"F19",131:"F20",132:"F21",133:"F22",134:"F23",135:"F24",59:";",61:"=",186:";",187:"=",188:",",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},i.aliases={escape:"esc","delete":"del","return":"enter",ctrl:"control",space:"spacebar",ins:"insert",cmd:"meta",command:"meta",wins:"meta",windows:"meta"},i.normalize=function(n){var i,r,u,f,t,e;for(t=n.toLowerCase().replace(/\s+/gi,"").split("+"),i=r=0,e=t.length;r<e;i=++r)u=t[i],t[i]=this.aliases[u]||u;return f=t.pop(),t.sort().push(f),t.join("_")},i.prototype.opts={el:document},i.prototype._init=function(){this.id=++this.constructor.count;this._map={};this._delegate=typeof this.opts.el=="string"?document:this.opts.el;return n(this._delegate).on("keydown.simple-hotkeys-"+this.id,this.opts.el,function(n){return function(t){var i;if((i=n._getHander(t))!=null)return i.call(n,t)}}(this))},i.prototype._getHander=function(n){var i,t;if((i=this.constructor.keyNameMap[n.which]))return t="",n.altKey&&(t+="alt_"),n.ctrlKey&&(t+="control_"),n.metaKey&&(t+="meta_"),n.shiftKey&&(t+="shift_"),t+=i.toLowerCase(),this._map[t]},i.prototype.respondTo=function(n){return typeof n=="string"?this._map[this.constructor.normalize(n)]!=null:this._getHander(n)!=null},i.prototype.add=function(n,t){return this._map[this.constructor.normalize(n)]=t,this},i.prototype.remove=function(n){return delete this._map[this.constructor.normalize(n)],this},i.prototype.destroy=function(){return n(this._delegate).off(".simple-hotkeys-"+this.id),this._map={},this},i}(t),function(n){return new i(n)}}),function(n,t){typeof define=="function"&&define.amd?define("simple-uploader",["jquery","simple-module"],function(i,r){return n.uploader=t(i,r)}):typeof exports=="object"?module.exports=t(require("jquery"),require("simple-module")):(n.simple=n.simple||{},n.simple.uploader=t(jQuery,SimpleModule))}(this,function(n,t){var i,r=function(n,t){function r(){this.constructor=n}for(var i in t)u.call(t,i)&&(n[i]=t[i]);return r.prototype=t.prototype,n.prototype=new r,n.__super__=t.prototype,n},u={}.hasOwnProperty;return i=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return r(i,t),i.count=0,i.prototype.opts={url:"",params:null,fileKey:"upload_file",connectionCount:3},i.prototype._init=function(){this.files=[];this.queue=[];this.id=++i.count;this.on("uploadcomplete",function(t){return function(i,r){return(t.files.splice(n.inArray(r,t.files),1),t.queue.length>0&&t.files.length<t.opts.connectionCount)?t.upload(t.queue.shift()):t.files.length===0?t.uploading=!1:void 0}}(this));return n(window).on("beforeunload.uploader-"+this.id,function(n){return function(t){if(n.uploading)return t.originalEvent.returnValue=n._t("leaveConfirm"),n._t("leaveConfirm")}}(this))},i.prototype.generateId=function(){var n;return n=0,function(){return n+=1}}(),i.prototype.upload=function(t,i){var f,r,u,e;if(i==null&&(i={}),t!=null){if(n.isArray(t)||t instanceof FileList)for(r=0,e=t.length;r<e;r++)f=t[r],this.upload(f,i);else n(t).is("input:file")?(u=n(t).attr("name"),u&&(i.fileKey=u),this.upload(n.makeArray(n(t)[0].files),i)):t.id&&t.obj||(t=this.getFile(t));if(t&&t.obj){if(n.extend(t,i),this.files.length>=this.opts.connectionCount){this.queue.push(t);return}if(this.triggerHandler("beforeupload",[t])!==!1)return this.files.push(t),this._xhrUpload(t),this.uploading=!0}}},i.prototype.getFile=function(n){var t,i,r;if(n instanceof window.File||n instanceof window.Blob)t=(i=n.fileName)!=null?i:n.name;else return null;return{id:this.generateId(),url:this.opts.url,params:this.opts.params,fileKey:this.opts.fileKey,name:t,size:(r=n.fileSize)!=null?r:n.size,ext:t?t.split(".").pop().toLowerCase():"",obj:n}},i.prototype._xhrUpload=function(t){var i,r,u,f;if(i=new FormData,i.append(t.fileKey,t.obj),i.append("original_filename",t.name),t.params){u=t.params;for(r in u)f=u[r],i.append(r,f)}return t.xhr=n.ajax({url:t.url,data:i,processData:!1,contentType:!1,type:"POST",headers:{"X-File-Name":encodeURIComponent(t.name)},xhr:function(){var t;return t=n.ajaxSettings.xhr(),t&&(t.upload.onprogress=function(n){return function(t){return n.progress(t)}}(this)),t},progress:function(n){return function(i){if(i.lengthComputable)return n.trigger("uploadprogress",[t,i.loaded,i.total])}}(this),error:function(n){return function(i,r){return n.trigger("uploaderror",[t,i,r])}}(this),success:function(i){return function(r){return i.trigger("uploadprogress",[t,t.size,t.size]),i.trigger("uploadsuccess",[t,r]),n(document).trigger("uploadsuccess",[t,r,i])}}(this),complete:function(n){return function(i){return n.trigger("uploadcomplete",[t,i.responseText])}}(this)})},i.prototype.cancel=function(n){var i,t,u,r;if(!n.id)for(r=this.files,t=0,u=r.length;t<u;t++)if(i=r[t],i.id===n*1){n=i;break}return this.trigger("uploadcancel",[n]),n.xhr&&n.xhr.abort(),n.xhr=null},i.prototype.readImageFile=function(t,i){var u,r;if(n.isFunction(i))return r=new Image,r.onload=function(){return i(r)},r.onerror=function(){return i()},window.FileReader&&FileReader.prototype.readAsDataURL&&/^image/.test(t.type)?(u=new FileReader,u.onload=function(n){return r.src=n.target.result},u.readAsDataURL(t)):i()},i.prototype.destroy=function(){var r,t,u,i;for(this.queue.length=0,i=this.files,t=0,u=i.length;t<u;t++)r=i[t],this.cancel(r);return n(window).off(".uploader-"+this.id),n(document).off(".uploader-"+this.id)},i.i18n={"zh-CN":{leaveConfirm:"正在上传文件，如果离开上传会自动取消"}},i.locale="zh-CN",i}(t),function(n){return new i(n)}});
/*!
* Simditor v2.3.12
* http://simditor.tower.im/
* 2018-02-28
*/
(function(n,t){typeof define=="function"&&define.amd?define("simditor",["jquery","simple-module","simple-hotkeys","simple-uploader"],function(i,r,u,f){return n.Simditor=t(i,r,u,f)}):typeof exports=="object"?module.exports=t(require("jquery"),require("simple-module"),require("simple-hotkeys"),require("simple-uploader")):n.Simditor=t(jQuery,SimpleModule,simple.hotkeys,simple.uploader)})(this,function(n,t,i,r){var l,a,v,e,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,c,ht,ct,s,lt,f,at,vt,yt,pt,wt,bt,kt,dt,u=function(n,t){function r(){this.constructor=n}for(var i in t)gt.call(t,i)&&(n[i]=t[i]);return r.prototype=t.prototype,n.prototype=new r,n.__super__=t.prototype,n},gt={}.hasOwnProperty,h=[].indexOf||function(n){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===n)return t;return-1},o=[].slice;return lt=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return u(i,t),i.pluginName="Selection",i.prototype._range=null,i.prototype._startNodes=null,i.prototype._endNodes=null,i.prototype._containerNode=null,i.prototype._nodes=null,i.prototype._blockNodes=null,i.prototype._rootNodes=null,i.prototype._init=function(){this.editor=this._module;this._selection=document.getSelection();this.editor.on("selectionchanged",function(n){return function(){return n.reset(),n._range=n._selection.getRangeAt(0)}}(this));this.editor.on("blur",function(n){return function(){return n.reset()}}(this));return this.editor.on("focus",function(n){return function(){return n.reset(),n._range=n._selection.getRangeAt(0)}}(this))},i.prototype.reset=function(){return this._range=null,this._startNodes=null,this._endNodes=null,this._containerNode=null,this._nodes=null,this._blockNodes=null,this._rootNodes=null},i.prototype.clear=function(){var n;try{this._selection.removeAllRanges()}catch(t){n=t}return this.reset()},i.prototype.range=function(n){var t;return n?(this.clear(),this._selection.addRange(n),this._range=n,t=this.editor.util.browser.firefox||this.editor.util.browser.msie,!this.editor.inputManager.focused&&t&&this.editor.body.focus()):!this._range&&this.editor.inputManager.focused&&this._selection.rangeCount&&(this._range=this._selection.getRangeAt(0)),this._range},i.prototype.startNodes=function(){return this._range&&(this._startNodes||(this._startNodes=function(t){return function(){var i;return i=n(t._range.startContainer).parentsUntil(t.editor.body).get(),i.unshift(t._range.startContainer),n(i)}}(this)())),this._startNodes},i.prototype.endNodes=function(){var t;return this._range&&(this._endNodes||(this._endNodes=this._range.collapsed?this.startNodes():(t=n(this._range.endContainer).parentsUntil(this.editor.body).get(),t.unshift(this._range.endContainer),n(t)))),this._endNodes},i.prototype.containerNode=function(){return this._range&&(this._containerNode||(this._containerNode=n(this._range.commonAncestorContainer))),this._containerNode},i.prototype.nodes=function(){return this._range&&(this._nodes||(this._nodes=function(t){return function(){var i;return i=[],t.startNodes().first().is(t.endNodes().first())?i=t.startNodes().get():(t.startNodes().each(function(r,u){var s,f,e,h,c,o,l;return f=n(u),t.endNodes().index(f)>-1?i.push(u):f.parent().is(t.editor.body)||(o=t.endNodes().index(f.parent()))>-1?(s=o&&o>-1?t.endNodes().eq(o-1):t.endNodes().last(),e=f.parent().contents(),l=e.index(f),h=e.index(s),n.merge(i,e.slice(l,h).get())):(e=f.parent().contents(),c=e.index(f),n.merge(i,e.slice(c).get()))}),t.endNodes().each(function(r,u){var f,e,o;return f=n(u),f.parent().is(t.editor.body)||t.startNodes().index(f.parent())>-1?(i.push(u),!1):(e=f.parent().contents(),o=e.index(f),n.merge(i,e.slice(0,o+1)))})),n(n.unique(i))}}(this)())),this._nodes},i.prototype.blockNodes=function(){if(this._range)return this._blockNodes||(this._blockNodes=function(n){return function(){return n.nodes().filter(function(t,i){return n.editor.util.isBlockNode(i)})}}(this)()),this._blockNodes},i.prototype.rootNodes=function(){if(this._range)return this._rootNodes||(this._rootNodes=function(t){return function(){return t.nodes().filter(function(i,r){var u;return u=n(r).parent(),u.is(t.editor.body)||u.is("blockquote")})}}(this)()),this._rootNodes},i.prototype.rangeAtEndOf=function(t,i){var e,o,r,u,s,f;if(i==null&&(i=this.range()),i&&i.collapsed)return(t=n(t)[0],r=i.endContainer,u=this.editor.util.getNodeLength(r),o=i.endOffset===u-1,s=n(r).contents().last().is("br"),e=i.endOffset===u,!(o&&s||e))?!1:t===r?!0:n.contains(t,r)?(f=!0,n(r).parentsUntil(t).addBack().each(function(t,i){var r,u,e,o;return o=n(i).parent().contents().filter(function(){return!(this!==i&&this.nodeType===3&&!this.nodeValue)}),r=o.last(),e=r.get(0)===i,u=r.is("br")&&r.prev().get(0)===i,(e||u)?void 0:(f=!1,!1)}),f):!1},i.prototype.rangeAtStartOf=function(t,i){var u,r;if(i==null&&(i=this.range()),i&&i.collapsed)return(t=n(t)[0],r=i.startContainer,i.startOffset!==0)?!1:t===r?!0:n.contains(t,r)?(u=!0,n(r).parentsUntil(t).addBack().each(function(t,i){var r;return r=n(i).parent().contents().filter(function(){return!(this!==i&&this.nodeType===3&&!this.nodeValue)}),r.first().get(0)!==i?u=!1:void 0}),u):!1},i.prototype.insertNode=function(t,i){if(i==null&&(i=this.range()),i)return t=n(t)[0],i.insertNode(t),this.setRangeAfter(t,i)},i.prototype.setRangeAfter=function(t,i){if(i==null&&(i=this.range()),i!=null)return t=n(t)[0],i.setEndAfter(t),i.collapse(!1),this.range(i)},i.prototype.setRangeBefore=function(t,i){if(i==null&&(i=this.range()),i!=null)return t=n(t)[0],i.setEndBefore(t),i.collapse(!1),this.range(i)},i.prototype.setRangeAtStartOf=function(t,i){return i==null&&(i=this.range()),t=n(t).get(0),i.setEnd(t,0),i.collapse(!1),this.range(i)},i.prototype.setRangeAtEndOf=function(t,i){var r,e,o,u,s,h,f;return i==null&&(i=this.range()),e=n(t),t=e[0],e.is("pre")?(o=e.contents(),o.length>0?(u=o.last(),h=u.text(),s=this.editor.util.getNodeLength(u[0]),h.charAt(h.length-1)==="\n"?i.setEnd(u[0],s-1):i.setEnd(u[0],s)):i.setEnd(t,0)):(f=this.editor.util.getNodeLength(t),t.nodeType!==3&&f>0&&(r=n(t).contents().last(),r.is("br")?f-=1:r[0].nodeType!==3&&this.editor.util.isEmptyNode(r)&&(r.append(this.editor.util.phBr),t=r[0],f=0)),i.setEnd(t,f)),i.collapse(!1),this.range(i)},i.prototype.deleteRangeContents=function(n){var r,u,t,i;return n==null&&(n=this.range()),i=n.cloneRange(),t=n.cloneRange(),i.collapse(!0),t.collapse(!1),u=this.rangeAtStartOf(this.editor.body,i),r=this.rangeAtEndOf(this.editor.body,t),!n.collapsed&&u&&r?(this.editor.body.empty(),n.setStart(this.editor.body[0],0),n.collapse(!0),this.range(n)):n.deleteContents(),n},i.prototype.breakBlockEl=function(t,i){var r;return(i==null&&(i=this.range()),r=n(t),!i.collapsed)?r:(i.setStartBefore(r.get(0)),i.collapsed)?r:r.before(i.extractContents())},i.prototype.save=function(t){var r,i,u;if(t==null&&(t=this.range()),!this._selectionSaved)return i=t.cloneRange(),i.collapse(!1),u=n("<span/>").addClass("simditor-caret-start"),r=n("<span/>").addClass("simditor-caret-end"),i.insertNode(r[0]),t.insertNode(u[0]),this.clear(),this._selectionSaved=!0},i.prototype.restore=function(){var n,r,f,i,t,u,e;return this._selectionSaved?(t=this.editor.body.find(".simditor-caret-start"),n=this.editor.body.find(".simditor-caret-end"),t.length&&n.length?(u=t.parent(),e=u.contents().index(t),r=n.parent(),f=r.contents().index(n),u[0]===r[0]&&(f-=1),i=document.createRange(),i.setStart(u.get(0),e),i.setEnd(r.get(0),f),t.remove(),n.remove(),this.range(i)):(t.remove(),n.remove()),this._selectionSaved=!1,i):!1},i}(t),d=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return u(i,t),i.pluginName="Formatter",i.prototype.opts={allowedTags:[],allowedAttributes:{},allowedStyles:{}},i.prototype._init=function(){this.editor=this._module;this._allowedTags=n.merge(["br","span","a","img","b","strong","i","strike","u","font","p","ul","ol","li","blockquote","pre","code","h1","h2","h3","h4","hr"],this.opts.allowedTags);this._allowedAttributes=n.extend({img:["src","alt","width","height","data-non-image"],a:["href","target"],font:["color"],code:["class"]},this.opts.allowedAttributes);this._allowedStyles=n.extend({span:["color","font-size"],b:["color"],i:["color"],strong:["color"],strike:["color"],u:["color"],p:["margin-left","text-align"],h1:["margin-left","text-align"],h2:["margin-left","text-align"],h3:["margin-left","text-align"],h4:["margin-left","text-align"]},this.opts.allowedStyles);return this.editor.body.on("click","a",function(){return!1})},i.prototype.decorate=function(n){return n==null&&(n=this.editor.body),this.editor.trigger("decorate",[n]),n},i.prototype.undecorate=function(n){return n==null&&(n=this.editor.body.clone()),this.editor.trigger("undecorate",[n]),n},i.prototype.autolink=function(t){var l,s,h,u,f,a,e,i,c,r,v,o,y;for(t==null&&(t=this.editor.body),e=[],h=function(i){return i.contents().each(function(i,r){var u,f;if(u=n(r),!u.is("a")&&!u.closest("a, pre",t).length)return!u.is("iframe")&&u.contents().length?h(u):(f=u.text())&&/https?:\/\/|www\./ig.test(f)?e.push(u):void 0})},h(t),c=/(https?:\/\/|www\.)[\w\-\.\?&=\/#%:,@\!\+]+/ig,u=0,a=e.length;u<a;u++){for(s=e[u],o=s.text(),r=[],i=null,f=0;(i=c.exec(o))!==null;)v=o.substring(f,i.index),r.push(document.createTextNode(v)),f=c.lastIndex,y=/^(http(s)?:\/\/|\/)/.test(i[0])?i[0]:"http://"+i[0],l=n('<a href="'+y+'" rel="nofollow"><\/a>').text(i[0]),r.push(l[0]);r.push(document.createTextNode(o.substring(f)));s.replaceWith(n(r))}return t},i.prototype.format=function(t){var u,i,f,e,h,c,l,r,o,s;if(t==null&&(t=this.editor.body),t.is(":empty"))return t.append("<p>"+this.editor.util.phBr+"<\/p>"),t;for(o=t.contents(),f=0,h=o.length;f<h;f++)l=o[f],this.cleanNode(l,!0);for(s=t.contents(),e=0,c=s.length;e<c;e++)r=s[e],u=n(r),u.is("br")?(typeof i!="undefined"&&i!==null&&(i=null),u.remove()):this.editor.util.isBlockNode(r)?u.is("li")?i&&i.is("ul, ol")?i.append(r):(i=n("<ul/>").insertBefore(r),i.append(r)):i=null:((!i||i.is("ul, ol"))&&(i=n("<p/>").insertBefore(r)),i.append(r),this.editor.util.isEmptyNode(i)&&i.append(this.editor.util.phBr));return t},i.prototype.cleanNode=function(t,i){var p,s,r,c,w,l,f,u,a,e,o,b,k,d,v,g,y,nt;if(r=n(t),r.length>0){if(r[0].nodeType===3){y=r.text().replace(/(\r\n|\n|\r)/gm,"");y?(nt=document.createTextNode(y),r.replaceWith(nt)):r.remove();return}if(u=r.is("iframe")?null:r.contents(),a=this.editor.util.isDecoratedNode(r),r.is(this._allowedTags.join(","))||a){if(r.is("a")&&(s=r.find("img")).length>0&&(r.replaceWith(s),r=s,u=null),r.is("td")&&(p=r.find(this.editor.util.blockNodes.join(","))).length>0&&(p.each(function(){return function(t,i){return n(i).contents().unwrap()}}(this)),u=r.contents()),r.is("img")&&r.hasClass("uploading")&&r.remove(),!a){for(l=this._allowedAttributes[r[0].tagName.toLowerCase()],v=n.makeArray(r[0].attributes),e=0,b=v.length;e<b;e++)(f=v[e],f.name!=="style")&&(l!=null&&(g=f.name,h.call(l,g)>=0)||r.removeAttr(f.name));this._cleanNodeStyles(r);r.is("span")&&(r[0].attributes.length===0&&r.contents().first().unwrap(),r[0].style.length===2&&r[0].style.color==="rgb(51, 51, 51)"&&r[0].style.fontSize==="16px"&&r.contents().unwrap())}}else r[0].nodeType!==1||r.is(":empty")?(r.remove(),u=null):r.is("div, article, dl, header, footer, tr")?(r.append("<br/>"),u.first().unwrap()):r.is("table")?(c=n("<p/>"),r.find("tr").each(function(t,i){return c.append(n(i).text()+"<br/>")}),r.replaceWith(c),u=null):r.is("thead, tfoot")?(r.remove(),u=null):r.is("th")?(w=n("<td/>").append(r.contents()),r.replaceWith(w)):u.first().unwrap();if(i&&u!=null&&!r.is("pre"))for(o=0,k=u.length;o<k;o++)d=u[o],this.cleanNode(d,!0);return null}},i.prototype._cleanNodeStyles=function(t){var r,u,c,i,o,l,f,s,e;if(s=t.attr("style"),s){if(t.removeAttr("style"),r=this._allowedStyles[t[0].tagName.toLowerCase()],!(r&&r.length>0))return t;for(e={},o=s.split(";"),u=0,c=o.length;u<c;u++)(f=o[u],f=n.trim(f),i=f.split(":"),i.length===2)&&(i[0]==="font-size"&&i[1].indexOf("px")>0&&parseInt(i[1],10)<12||(l=i[0],h.call(r,l)>=0)&&(e[n.trim(i[0])]=n.trim(i[1])));return Object.keys(e).length>0&&t.css(e),t}},i.prototype.clearHtml=function(t,i){var f,u,r;return i==null&&(i=!0),f=n("<div/>").append(t),u=f.contents(),r="",u.each(function(t){return function(f,e){var o,s;return e.nodeType===3?r+=e.nodeValue:e.nodeType===1&&(o=n(e),s=o.is("iframe")?null:o.contents(),s&&s.length>0&&(r+=t.clearHtml(s)),i&&f<u.length-1&&o.is("br, p, div, li,tr, pre, address, artticle, aside, dl, figcaption, footer, h1, h2,h3, h4, header"))?r+="\n":void 0}}(this)),r},i.prototype.beautify=function(t){var i;return i=function(n){return!!(n.is("p")&&!n.text()&&n.children(":not(br)").length<1)},t.each(function(t,r){var u,f;return u=n(r),f=u.is(':not(img, br, col, td, hr, [class^="simditor-"]):empty'),(f||i(u))&&u.remove(),u.find(':not(img, br, col, td, hr, [class^="simditor-"]):empty').remove()})},i}(t),ut=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return u(i,t),i.pluginName="InputManager",i.prototype._modifierKeys=[16,17,18,91,93,224],i.prototype._arrowKeys=[37,38,39,40],i.prototype._init=function(){var t,i;this.editor=this._module;this.throttledValueChanged=this.editor.util.throttle(function(n){return function(t){return setTimeout(function(){return n.editor.trigger("valuechanged",t)},10)}}(this),300);this.throttledSelectionChanged=this.editor.util.throttle(function(n){return function(){return n.editor.trigger("selectionchanged")}}(this),50);n(document).on("selectionchange.simditor"+this.editor.id,function(n){return function(){var t;if((n.focused&&!n.editor.clipboard.pasting))return t=function(){return n._selectionTimer&&(clearTimeout(n._selectionTimer),n._selectionTimer=null),n.editor.selection._selection.rangeCount>0?n.throttledSelectionChanged():n._selectionTimer=setTimeout(function(){return n._selectionTimer=null,n.focused?t():void 0},10)},t()}}(this));this.editor.on("valuechanged",function(t){return function(){var i;return t.lastCaretPosition=null,i=t.editor.body.children().filter(function(n,i){return t.editor.util.isBlockNode(i)}),t.focused&&i.length===0&&(t.editor.selection.save(),t.editor.formatter.format(),t.editor.selection.restore()),t.editor.body.find("hr, pre, .simditor-table").each(function(i,r){var u,f;return u=n(r),(u.parent().is("blockquote")||u.parent()[0]===t.editor.body[0])&&(f=!1,u.next().length===0&&(n("<p/>").append(t.editor.util.phBr).insertAfter(u),f=!0),u.prev().length===0&&(n("<p/>").append(t.editor.util.phBr).insertBefore(u),f=!0),f)?t.throttledValueChanged():void 0}),t.editor.body.find("pre:empty").append(t.editor.util.phBr),!t.editor.util.support.onselectionchange&&t.focused?t.throttledSelectionChanged():void 0}}(this));this.editor.body.on("keydown",n.proxy(this._onKeyDown,this)).on("keypress",n.proxy(this._onKeyPress,this)).on("keyup",n.proxy(this._onKeyUp,this)).on("mouseup",n.proxy(this._onMouseUp,this)).on("focus",n.proxy(this._onFocus,this)).on("blur",n.proxy(this._onBlur,this)).on("drop",n.proxy(this._onDrop,this)).on("input",n.proxy(this._onInput,this));return this.editor.util.browser.firefox&&(this.editor.hotkeys.add("cmd+left",function(n){return function(t){return t.preventDefault(),n.editor.selection._selection.modify("move","backward","lineboundary"),!1}}(this)),this.editor.hotkeys.add("cmd+right",function(n){return function(t){return t.preventDefault(),n.editor.selection._selection.modify("move","forward","lineboundary"),!1}}(this)),t=this.editor.util.os.mac?"cmd+a":"ctrl+a",this.editor.hotkeys.add(t,function(n){return function(){var t,u,r,i;if(t=n.editor.body.children(),t.length>0)return u=t.first().get(0),r=t.last().get(0),i=document.createRange(),i.setStart(u,0),i.setEnd(r,n.editor.util.getNodeLength(r)),n.editor.selection.range(i),!1}}(this))),i=this.editor.util.os.mac?"cmd+enter":"ctrl+enter",this.editor.hotkeys.add(i,function(n){return function(){return n.editor.el.closest("form").find("button:submit").click(),!1}}(this))},i.prototype._onFocus=function(){if(!this.editor.clipboard.pasting)return this.editor.el.addClass("focus").removeClass("error"),this.focused=!0,setTimeout(function(n){return function(){var i,t;return t=n.editor.selection._selection.getRangeAt(0),t.startContainer===n.editor.body[0]&&(n.lastCaretPosition?n.editor.undoManager.caretPosition(n.lastCaretPosition):(i=n.editor.body.children().first(),t=document.createRange(),n.editor.selection.setRangeAtStartOf(i,t))),n.lastCaretPosition=null,n.editor.triggerHandler("focus"),n.editor.util.support.onselectionchange?void 0:n.throttledSelectionChanged()}}(this),0)},i.prototype._onBlur=function(){var n;if(!this.editor.clipboard.pasting)return this.editor.el.removeClass("focus"),this.editor.sync(),this.focused=!1,this.lastCaretPosition=(n=this.editor.undoManager.currentState())!=null?n.caret:void 0,this.editor.triggerHandler("blur")},i.prototype._onMouseUp=function(){if(!this.editor.util.support.onselectionchange)return this.throttledSelectionChanged()},i.prototype._onKeyDown=function(n){var t,i;return this.editor.triggerHandler(n)===!1?!1:this.editor.hotkeys.respondTo(n)?void 0:this.editor.keystroke.respondTo(n)?(this.throttledValueChanged(),!1):(t=n.which,h.call(this._modifierKeys,t)>=0)||(i=n.which,h.call(this._arrowKeys,i)>=0)?void 0:this.editor.util.metaKey(n)&&n.which===86?void 0:(this.editor.util.support.oninput||this.throttledValueChanged(["typing"]),null)},i.prototype._onKeyPress=function(n){if(this.editor.triggerHandler(n)===!1)return!1},i.prototype._onKeyUp=function(t){var i,r;if(this.editor.triggerHandler(t)===!1)return!1;if(!this.editor.util.support.onselectionchange&&(r=t.which,h.call(this._arrowKeys,r)>=0)){this.throttledValueChanged();return}(t.which===8||t.which===46)&&this.editor.util.isEmptyNode(this.editor.body)&&(this.editor.body.empty(),i=n("<p/>").append(this.editor.util.phBr).appendTo(this.editor.body),this.editor.selection.setRangeAtStartOf(i))},i.prototype._onDrop=function(n){return this.editor.triggerHandler(n)===!1?!1:this.throttledValueChanged()},i.prototype._onInput=function(){return this.throttledValueChanged(["oninput"])},i}(t),et=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return u(i,t),i.pluginName="Keystroke",i.prototype._init=function(){return this.editor=this._module,this._keystrokeHandlers={},this._initKeystrokeHandlers()},i.prototype.add=function(n,t,i){return n=n.toLowerCase(),n=this.editor.hotkeys.constructor.aliases[n]||n,this._keystrokeHandlers[n]||(this._keystrokeHandlers[n]={}),this._keystrokeHandlers[n][t]=i},i.prototype.respondTo=function(t){var u,r,f,i;if(r=(f=this.editor.hotkeys.constructor.keyNameMap[t.which])!=null?f.toLowerCase():void 0,r)return r in this._keystrokeHandlers&&(i=typeof(u=this._keystrokeHandlers[r])["*"]=="function"?u["*"](t):void 0,i||this.editor.selection.startNodes().each(function(u){return function(f,e){var o,s;if(e.nodeType===Node.ELEMENT_NODE)return o=(s=u._keystrokeHandlers[r])!=null?s[e.tagName.toLowerCase()]:void 0,i=typeof o=="function"?o(t,n(e)):void 0,i===!0||i===!1?!1:void 0}}(this)),i)?!0:void 0},i.prototype._initKeystrokeHandlers=function(){var t;return this.editor.util.browser.safari&&this.add("enter","*",function(t){return function(i){var u,r;if(i.shiftKey)return(u=t.editor.selection.blockNodes().last(),u.is("pre"))?void 0:(r=n("<br/>"),t.editor.selection.rangeAtEndOf(u)?(t.editor.selection.insertNode(r),t.editor.selection.insertNode(n("<br/>")),t.editor.selection.setRangeBefore(r)):t.editor.selection.insertNode(r),!0)}}(this)),(this.editor.util.browser.webkit||this.editor.util.browser.msie)&&(t=function(t){return function(i,r){var u;if(t.editor.selection.rangeAtEndOf(r))return u=n("<p/>").append(t.editor.util.phBr).insertAfter(r),t.editor.selection.setRangeAtStartOf(u),!0}}(this),this.add("enter","h1",t),this.add("enter","h2",t),this.add("enter","h3",t),this.add("enter","h4",t),this.add("enter","h5",t),this.add("enter","h6",t)),this.add("backspace","*",function(n){return function(){var t,i,r,u;return(r=n.editor.selection.rootNodes().first(),i=r.prev(),i.is("hr")&&n.editor.selection.rangeAtStartOf(r))?(n.editor.selection.save(),i.remove(),n.editor.selection.restore(),!0):(t=n.editor.selection.blockNodes().last(),u=n.editor.util.browser.webkit,u&&n.editor.selection.rangeAtStartOf(t)?(n.editor.selection.save(),n.editor.formatter.cleanNode(t,!0),n.editor.selection.restore(),null):void 0)}}(this)),this.add("enter","li",function(t){return function(i,r){var o,u,f,e;if(o=r.clone(),o.find("ul, ol").remove(),t.editor.util.isEmptyNode(o)&&r.is(t.editor.selection.blockNodes().last())){if(u=r.parent(),r.next("li").length>0){if(!t.editor.util.isEmptyNode(r))return;u.parent("li").length>0?(f=n("<li/>").append(t.editor.util.phBr).insertAfter(u.parent("li")),e=n("<"+u[0].tagName+"/>").append(r.nextAll("li")),f.append(e)):(f=n("<p/>").append(t.editor.util.phBr).insertAfter(u),e=n("<"+u[0].tagName+"/>").append(r.nextAll("li")),f.after(e))}else u.parent("li").length>0?(f=n("<li/>").insertAfter(u.parent("li")),r.contents().length>0?f.append(r.contents()):f.append(t.editor.util.phBr)):(f=n("<p/>").append(t.editor.util.phBr).insertAfter(u),r.children("ul, ol").length>0&&f.after(r.children("ul, ol")));return r.prev("li").length?r.remove():u.remove(),t.editor.selection.setRangeAtStartOf(f),!0}}}(this)),this.add("enter","pre",function(t){return function(i,r){var e,f,u;return(i.preventDefault(),i.shiftKey)?(e=n("<p/>").append(t.editor.util.phBr).insertAfter(r),t.editor.selection.setRangeAtStartOf(e),!0):(u=t.editor.selection.range(),f=null,u.deleteContents(),!t.editor.util.browser.msie&&t.editor.selection.rangeAtEndOf(r)?(f=document.createTextNode("\n\n"),u.insertNode(f),u.setEnd(f,1)):(f=document.createTextNode("\n"),u.insertNode(f),u.setStartAfter(f)),u.collapse(!1),t.editor.selection.range(u),!0)}}(this)),this.add("enter","blockquote",function(n){return function(t,i){var r,u;if(r=n.editor.selection.blockNodes().last(),r.is("p")&&!r.next().length&&n.editor.util.isEmptyNode(r))return i.after(r),u=document.createRange(),n.editor.selection.setRangeAtStartOf(r,u),!0}}(this)),this.add("backspace","li",function(t){return function(i,r){var c,o,l,s,f,u,a,h,e;return(o=r.children("ul, ol"),f=r.prev("li"),!(o.length>0&&f.length>0))?!1:(e="",u=null,r.contents().each(function(t,i){return i.nodeType===1&&/UL|OL/.test(i.nodeName)?!1:i.nodeType===1&&/BR/.test(i.nodeName)?void 0:(i.nodeType===3&&i.nodeValue?e+=i.nodeValue:i.nodeType===1&&(e+=n(i).text()),u=n(i))}),a=t.editor.util.browser.firefox&&!u.next("br").length,u&&e.length===1&&a)?(c=n(t.editor.util.phBr).insertAfter(u),u.remove(),t.editor.selection.setRangeBefore(c),!0):e.length>0?!1:(h=document.createRange(),s=f.children("ul, ol"),s.length>0?(l=n("<li/>").append(t.editor.util.phBr).appendTo(s),s.append(o.children("li")),r.remove(),t.editor.selection.setRangeAtEndOf(l,h)):(t.editor.selection.setRangeAtEndOf(f,h),f.append(o),r.remove(),t.editor.selection.range(h)),!0)}}(this)),this.add("backspace","pre",function(t){return function(i,r){var u,f,e;if(t.editor.selection.rangeAtStartOf(r))return f=r.html().replace("\n","<br/>")||t.editor.util.phBr,u=n("<p/>").append(f).insertAfter(r),r.remove(),e=document.createRange(),t.editor.selection.setRangeAtStartOf(u,e),!0}}(this)),this.add("backspace","blockquote",function(n){return function(t,i){var r,u;if(n.editor.selection.rangeAtStartOf(i))return r=i.children().first().unwrap(),u=document.createRange(),n.editor.selection.setRangeAtStartOf(r,u),!0}}(this))},i}(t),bt=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return u(i,t),i.pluginName="UndoManager",i.prototype._index=-1,i.prototype._capacity=20,i.prototype._startPosition=null,i.prototype._endPosition=null,i.prototype._init=function(){var n,t;this.editor=this._module;this._stack=[];this.editor.util.os.mac?(t="cmd+z",n="shift+cmd+z"):this.editor.util.os.win?(t="ctrl+z",n="ctrl+y"):(t="ctrl+z",n="shift+ctrl+z");this.editor.hotkeys.add(t,function(n){return function(t){return t.preventDefault(),n.undo(),!1}}(this));this.editor.hotkeys.add(n,function(n){return function(t){return t.preventDefault(),n.redo(),!1}}(this));this.throttledPushState=this.editor.util.throttle(function(n){return function(){return n._pushUndoState()}}(this),2e3);this.editor.on("valuechanged",function(n){return function(t,i){if(i!=="undo"&&i!=="redo")return n.throttledPushState()}}(this));this.editor.on("selectionchanged",function(n){return function(){return n.resetCaretPosition(),n.update()}}(this));this.editor.on("focus",function(n){return function(){if(n._stack.length===0)return n._pushUndoState()}}(this));return this.editor.on("blur",function(n){return function(){return n.resetCaretPosition()}}(this))},i.prototype.resetCaretPosition=function(){return this._startPosition=null,this._endPosition=null},i.prototype.startPosition=function(){return this.editor.selection._range&&(this._startPosition||(this._startPosition=this._getPosition("start"))),this._startPosition},i.prototype.endPosition=function(){return this.editor.selection._range&&(this._endPosition||(this._endPosition=function(n){return function(){var t;return(t=n.editor.selection.range(),t.collapsed)?n._startPosition:n._getPosition("end")}}(this)())),this._endPosition},i.prototype._pushUndoState=function(){var n;if(this.editor.triggerHandler("pushundostate")!==!1)return(n=this.caretPosition(),!n.start)?void 0:(this._index+=1,this._stack.length=this._index,this._stack.push({html:this.editor.body.html(),caret:this.caretPosition()}),this._stack.length>this._capacity?(this._stack.shift(),this._index-=1):void 0)},i.prototype.currentState=function(){return this._stack.length&&this._index>-1?this._stack[this._index]:null},i.prototype.undo=function(){var n;if(!(this._index<1)&&!(this._stack.length<2))return this.editor.hidePopover(),this._index-=1,n=this._stack[this._index],this.editor.body.get(0).innerHTML=n.html,this.caretPosition(n.caret),this.editor.body.find(".selected").removeClass("selected"),this.editor.sync(),this.editor.trigger("valuechanged",["undo"])},i.prototype.redo=function(){var n;if(!(this._index<0)&&!(this._stack.length<this._index+2))return this.editor.hidePopover(),this._index+=1,n=this._stack[this._index],this.editor.body.get(0).innerHTML=n.html,this.caretPosition(n.caret),this.editor.body.find(".selected").removeClass("selected"),this.editor.sync(),this.editor.trigger("valuechanged",["redo"])},i.prototype.update=function(){var n;if(n=this.currentState(),n)return n.html=this.editor.body.html(),n.caret=this.caretPosition()},i.prototype._getNodeOffset=function(t,i){var f,r,u;return f=n.isNumeric(i)?n(t):n(t).parent(),u=0,r=!1,f.contents().each(function(n,f){return t===f||i===n&&n===0?!1:(f.nodeType===Node.TEXT_NODE?!r&&f.nodeValue.length>0&&(u+=1,r=!0):(u+=1,r=!1),i-1===n)?!1:null}),u},i.prototype._getPosition=function(t){var u,r,e,f,o,i,s;if(t==null&&(t="start"),s=this.editor.selection.range(),f=s[t+"Offset"],u=this.editor.selection[t+"Nodes"](),r=u.first()[0],r.nodeType===Node.TEXT_NODE){for(i=r.previousSibling;i&&i.nodeType===Node.TEXT_NODE;)r=i,f+=this.editor.util.getNodeLength(i),i=i.previousSibling;e=u.get();e[0]=r;u=n(e)}else f=this._getNodeOffset(r,f);return o=[f],u.each(function(n){return function(t,i){return o.unshift(n._getNodeOffset(i))}}(this)),o},i.prototype._getNodeByPosition=function(t){var s,r,u,f,h,i,e,o;for(i=this.editor.body[0],o=t.slice(0,t.length-1),u=f=0,h=o.length;f<h;u=++f){if(e=o[u],r=i.childNodes,e>r.length-1)if(u===t.length-2&&n(i).is("pre:empty"))s=document.createTextNode(""),i.appendChild(s),r=i.childNodes;else{i=null;break}i=r[e]}return i},i.prototype.caretPosition=function(n){var i,u,t,r,f;if(n){if(!n.start)return;if(r=this._getNodeByPosition(n.start),f=n.start[n.start.length-1],n.collapsed?(i=r,u=f):(i=this._getNodeByPosition(n.end),u=n.start[n.start.length-1]),!r||!i){typeof console!="undefined"&&console!==null&&typeof console.warn=="function"&&console.warn("simditor: invalid caret state");return}return t=document.createRange(),t.setStart(r,f),t.setEnd(i,u),this.editor.selection.range(t)}return t=this.editor.selection.range(),this.editor.inputManager.focused&&t!=null?{start:this.startPosition(),end:this.endPosition(),collapsed:t.collapsed}:{}},i}(t),dt=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return u(i,t),i.pluginName="Util",i.prototype._init=function(){return this.editor=this._module,this.browser.msie&&this.browser.version<11?this.phBr="":void 0},i.prototype.phBr="<br/>",i.prototype.os=function(){var n;return n={},/Mac/.test(navigator.appVersion)?n.mac=!0:/Linux/.test(navigator.appVersion)?n.linux=!0:/Win/.test(navigator.appVersion)?n.win=!0:/X11/.test(navigator.appVersion)&&(n.unix=!0),/Mobi/.test(navigator.appVersion)&&(n.mobile=!0),n}(),i.prototype.browser=function(){var t,i,r,u,f,e,o,s,h,c,n;return n=navigator.userAgent,u=/(msie|trident)/i.test(n),t=/chrome|crios/i.test(n),c=/safari/i.test(n)&&!t,r=/firefox/i.test(n),i=/edge/i.test(n),u?{msie:!0,version:((f=n.match(/(msie |rv:)(\d+(\.\d+)?)/i))!=null?f[2]:void 0)*1}:i?{edge:!0,webkit:!0,version:((e=n.match(/edge\/(\d+(\.\d+)?)/i))!=null?e[1]:void 0)*1}:t?{webkit:!0,chrome:!0,version:((o=n.match(/(?:chrome|crios)\/(\d+(\.\d+)?)/i))!=null?o[1]:void 0)*1}:c?{webkit:!0,safari:!0,version:((s=n.match(/version\/(\d+(\.\d+)?)/i))!=null?s[1]:void 0)*1}:r?{mozilla:!0,firefox:!0,version:((h=n.match(/firefox\/(\d+(\.\d+)?)/i))!=null?h[1]:void 0)*1}:{}}(),i.prototype.support=function(){return{onselectionchange:function(){var t,n;if(n=document.onselectionchange,n!==void 0)try{return document.onselectionchange=0,document.onselectionchange===null}catch(i){t=i}finally{document.onselectionchange=n}return!1}(),oninput:function(){return!/(msie|trident)/i.test(navigator.userAgent)}()}}(),i.prototype.reflow=function(t){return t==null&&(t=document),n(t)[0].offsetHeight},i.prototype.metaKey=function(n){var t;return t=/Mac/.test(navigator.userAgent),t?n.metaKey:n.ctrlKey},i.prototype.isEmptyNode=function(t){var i;return i=n(t),i.is(":empty")||!i.text()&&!i.find(":not(br, span, div)").length},i.prototype.isDecoratedNode=function(t){return n(t).is('[class^="simditor-"]')},i.prototype.blockNodes=["div","p","ul","ol","li","blockquote","hr","pre","h1","h2","h3","h4","h5","table"],i.prototype.isBlockNode=function(t){return(t=n(t)[0],!t||t.nodeType===3)?!1:new RegExp("^("+this.blockNodes.join("|")+")$").test(t.nodeName.toLowerCase())},i.prototype.getNodeLength=function(t){t=n(t)[0];switch(t.nodeType){case 7:case 10:return 0;case 3:case 8:return t.length;default:return t.childNodes.length}},i.prototype.dataURLtoBlob=function(n){var o,r,s,l,u,a,f,e,h,t,c,i,v;if(f=window.Blob&&function(){var n;try{return Boolean(new Blob)}catch(t){return n=t,!1}}(),a=f&&window.Uint8Array&&function(){var n;try{return new Blob([new Uint8Array(100)]).size===100}catch(t){return n=t,!1}}(),o=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,v=f||o,!(v&&window.atob&&window.ArrayBuffer&&window.Uint8Array))return!1;for(u=n.split(",")[0].indexOf("base64")>=0?atob(n.split(",")[1]):decodeURIComponent(n.split(",")[1]),r=new ArrayBuffer(u.length),h=new Uint8Array(r),e=t=0,i=u.length;0<=i?t<=i:t>=i;e=0<=i?++t:--t)h[e]=u.charCodeAt(e);return(c=n.split(",")[0].split(":")[1].split(";")[0],f)?(l=a?h:r,new Blob([l],{type:c})):(s=new o,s.append(r),s.getBlob(c))},i.prototype.throttle=function(n,t){var r,u,f,e,o,s,i;return e=0,i=0,f=r=o=null,u=function(){return i=0,e=+new Date,o=n.apply(f,r),f=null,r=null},s=function(){var n;return f=this,r=arguments,n=new Date-e,i||(n>=t?u():i=setTimeout(u,t-n)),o},s.clear=function(){if(i)return clearTimeout(i),u()},s},i.prototype.formatHTML=function(t){var o,s,r,f,i,h,c,u,e;for(h=/<(\/?)(.+?)(\/?)>/g,u="",f=0,r=null,s="  ",c=function(n,t){return new Array(t+1).join(n)};(i=h.exec(t))!==null;)i.isBlockNode=n.inArray(i[2],this.blockNodes)>-1,i.isStartTag=i[1]!=="/"&&i[3]!=="/",i.isEndTag=i[1]==="/"||i[3]==="/",o=r?r.index+r[0].length:0,(e=t.substring(o,i.index)).length>0&&n.trim(e)&&(u+=e),i.isBlockNode&&i.isEndTag&&!i.isStartTag&&(f-=1),i.isBlockNode&&i.isStartTag&&(r&&r.isBlockNode&&r.isEndTag||(u+="\n"),u+=c(s,f)),u+=i[0],i.isBlockNode&&i.isEndTag&&(u+="\n"),i.isBlockNode&&i.isStartTag&&(f+=1),r=i;return n.trim(u)},i}(t),pt=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return u(i,t),i.pluginName="Toolbar",i.prototype.opts={toolbar:!0,toolbarFloat:!0,toolbarHidden:!1,toolbarFloatOffset:0},i.prototype._tpl={wrapper:'<div class="simditor-toolbar"><ul><\/ul><\/div>',separator:'<li><span class="separator"><\/span><\/li>'},i.prototype._init=function(){var t,r,i;if(this.editor=this._module,this.opts.toolbar){n.isArray(this.opts.toolbar)||(this.opts.toolbar=["bold","italic","underline","strikethrough","|","ol","ul","blockquote","code","|","link","image","|","indent","outdent"]);this._render();this.list.on("click",function(){return!1});this.wrapper.on("mousedown",function(n){return function(){return n.list.find(".menu-on").removeClass(".menu-on")}}(this));n(document).on("mousedown.simditor"+this.editor.id,function(n){return function(){return n.list.find(".menu-on").removeClass(".menu-on")}}(this));if(!this.opts.toolbarHidden&&this.opts.toolbarFloat){this.wrapper.css("top",this.opts.toolbarFloatOffset);i=0;r=function(n){return function(){return n.wrapper.css("position","static"),n.wrapper.width("auto"),n.editor.util.reflow(n.wrapper),n.wrapper.width(n.wrapper.outerWidth()),n.wrapper.css("left",n.editor.util.os.mobile?n.wrapper.position().left:n.wrapper.offset().left),n.wrapper.css("position",""),i=n.wrapper.outerHeight(),n.editor.placeholderEl.css("top",i),!0}}(this);t=null;n(window).on("resize.simditor-"+this.editor.id,function(){return t=r()});n(window).on("scroll.simditor-"+this.editor.id,function(u){return function(){var o,f,e;if(u.wrapper.is(":visible"))if(e=u.editor.wrapper.offset().top,o=e+u.editor.wrapper.outerHeight()-80,f=n(document).scrollTop()+u.opts.toolbarFloatOffset,f<=e||f>=o){if(u.editor.wrapper.removeClass("toolbar-floating").css("padding-top",""),u.editor.util.os.mobile)return u.wrapper.css("top",u.opts.toolbarFloatOffset)}else if(t||(t=r()),u.editor.wrapper.addClass("toolbar-floating").css("padding-top",i),u.editor.util.os.mobile)return u.wrapper.css("top",f-e+u.opts.toolbarFloatOffset)}}(this))}this.editor.on("destroy",function(n){return function(){return n.buttons.length=0}}(this));return n(document).on("mousedown.simditor-"+this.editor.id,function(n){return function(){return n.list.find("li.menu-on").removeClass("menu-on")}}(this))}},i.prototype._render=function(){var i,u,t,r;for(this.buttons=[],this.wrapper=n(this._tpl.wrapper).prependTo(this.editor.wrapper),this.list=this.wrapper.find("ul"),r=this.opts.toolbar,i=0,u=r.length;i<u;i++){if(t=r[i],t==="|"){n(this._tpl.separator).appendTo(this.list);continue}if(!this.constructor.buttons[t])throw new Error("simditor: invalid toolbar button "+t);this.buttons.push(new this.constructor.buttons[t]({editor:this.editor}))}if(this.opts.toolbarHidden)return this.wrapper.hide()},i.prototype.findButton=function(n){var t;return t=this.list.find(".toolbar-item-"+n).data("button"),t!=null?t:null},i.addButton=function(n){return this.buttons[n.prototype.name]=n},i.buttons={},i}(t),rt=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return u(i,t),i.pluginName="Indentation",i.prototype.opts={tabIndent:!0},i.prototype._init=function(){return this.editor=this._module,this.editor.keystroke.add("tab","*",function(n){return function(t){var i;if(i=n.editor.toolbar.findButton("code"),n.opts.tabIndent||i&&i.active)return n.indent(t.shiftKey)}}(this))},i.prototype.indent=function(t){var r,f,e,i,u;return e=this.editor.selection.startNodes(),f=this.editor.selection.endNodes(),r=this.editor.selection.blockNodes(),i=[],r=r.each(function(t,r){var u,f,e,s,o;for(u=!0,f=e=0,s=i.length;e<s;f=++e)if(o=i[f],n.contains(r,o)){u=!1;break}else if(n.contains(o,r)){i.splice(f,1,r);u=!1;break}if(u)return i.push(r)}),r=n(i),u=!1,r.each(function(n){return function(i,r){var f;return f=t?n.outdentBlock(r):n.indentBlock(r),f?u=f:void 0}}(this)),u},i.prototype.indentBlock=function(t){var i,h,r,u,f,c,e,o,s,l;if(i=n(t),i.length){if(i.is("pre")){if(c=this.editor.selection.containerNode(),!(c.is(i)||c.closest("pre").is(i)))return;this.indentText(this.editor.selection.range())}else if(i.is("li")){if(f=i.prev("li"),f.length<1)return;this.editor.selection.save();l=i.parent()[0].tagName;h=f.children("ul, ol");h.length>0?h.append(i):n("<"+l+"/>").append(i).appendTo(f);this.editor.selection.restore()}else if(i.is("p, h1, h2, h3, h4"))s=parseInt(i.css("margin-left"))||0,s=(Math.round(s/this.opts.indentWidth)+1)*this.opts.indentWidth,i.css("margin-left",s);else if(i.is("table")||i.is(".simditor-table")){if(e=this.editor.selection.containerNode().closest("td, th"),r=e.next("td, th"),r.length>0||(o=e.parent("tr"),u=o.next("tr"),u.length<1&&o.parent().is("thead")&&(u=o.parent("thead").next("tbody").find("tr:first")),r=u.find("td:first, th:first")),!(e.length>0&&r.length>0))return;this.editor.selection.setRangeAtEndOf(r)}else return!1;return!0}},i.prototype.indentText=function(n){var i,t;return i=n.toString().replace(/^(?=.+)/mg,"  "),t=document.createTextNode(i||"  "),n.deleteContents(),n.insertNode(t),i?(n.selectNode(t),this.editor.selection.range(n)):this.editor.selection.setRangeAfter(t)},i.prototype.outdentBlock=function(t){var i,r,c,l,u,o,s,h,f,e;if(i=n(t),i&&i.length>0){if(i.is("pre")){if(l=this.editor.selection.containerNode(),!(l.is(i)||l.closest("pre").is(i)))return;this.outdentText(e)}else if(i.is("li"))r=i.parent(),c=r.parent("li"),this.editor.selection.save(),c.length<1?(e=document.createRange(),e.setStartBefore(r[0]),e.setEndBefore(i[0]),r.before(e.extractContents()),n("<p/>").insertBefore(r).after(i.children("ul, ol")).append(i.contents()),i.remove()):(i.next("li").length>0&&n("<"+r[0].tagName+"/>").append(i.nextAll("li")).appendTo(i),i.insertAfter(c),r.children("li").length<1&&r.remove()),this.editor.selection.restore();else if(i.is("p, h1, h2, h3, h4"))f=parseInt(i.css("margin-left"))||0,f=Math.max(Math.round(f/this.opts.indentWidth)-1,0)*this.opts.indentWidth,i.css("margin-left",f===0?"":f);else if(i.is("table")||i.is(".simditor-table")){if(s=this.editor.selection.containerNode().closest("td, th"),u=s.prev("td, th"),u.length>0||(h=s.parent("tr"),o=h.prev("tr"),o.length<1&&h.parent().is("tbody")&&(o=h.parent("tbody").prev("thead").find("tr:first")),u=o.find("td:last, th:last")),!(s.length>0&&u.length>0))return;this.editor.selection.setRangeAtEndOf(u)}else return!1;return!0}},i.prototype.outdentText=function(){},i}(t),y=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return u(i,t),i.pluginName="Clipboard",i.prototype.opts={pasteImage:!1,cleanPaste:!1},i.prototype._init=function(){this.editor=this._module;this.opts.pasteImage&&typeof this.opts.pasteImage!="string"&&(this.opts.pasteImage="inline");return this.editor.body.on("paste",function(n){return function(t){var i;if(!n.pasting&&!n._pasteBin)return n.editor.triggerHandler(t)===!1?!1:(i=n.editor.selection.deleteRangeContents(),n.editor.body.html()?i.collapsed||i.collapse(!0):(n.editor.formatter.format(),n.editor.selection.setRangeAtStartOf(n.editor.body.find("p:first"))),n._processPasteByClipboardApi(t))?!1:(n.editor.inputManager.throttledValueChanged.clear(),n.editor.inputManager.throttledSelectionChanged.clear(),n.editor.undoManager.throttledPushState.clear(),n.editor.selection.reset(),n.editor.undoManager.resetCaretPosition(),n.pasting=!0,n._getPasteContent(function(t){return n._processPasteContent(t),n._pasteInBlockEl=null,n._pastePlainText=null,n.pasting=!1}))}}(this))},i.prototype._processPasteByClipboardApi=function(n){var t,i,u,r;if(!this.editor.util.browser.edge)return n.originalEvent.clipboardData&&n.originalEvent.clipboardData.items&&n.originalEvent.clipboardData.items.length>0&&(i=n.originalEvent.clipboardData.items[0],/^image\//.test(i.type))?(t=i.getAsFile(),!(t!=null&&this.opts.pasteImage))?void 0:(t.name||(t.name="Clipboard Image.png"),this.editor.triggerHandler("pasting",[t])===!1)?void 0:(r={},r[this.opts.pasteImage]=!0,(u=this.editor.uploader)!=null&&u.upload(t,r),!0):void 0},i.prototype._getPasteContent=function(t){var i;return this._pasteBin=n('<div contenteditable="true" />').addClass("simditor-paste-bin").attr("tabIndex","-1").appendTo(this.editor.el),i={html:this.editor.body.html(),caret:this.editor.undoManager.caretPosition()},this._pasteBin.focus(),setTimeout(function(r){return function(){var u;return r.editor.hidePopover(),r.editor.body.get(0).innerHTML=i.html,r.editor.undoManager.caretPosition(i.caret),r.editor.body.focus(),r.editor.selection.reset(),r.editor.selection.range(),r._pasteInBlockEl=r.editor.selection.blockNodes().last(),r._pastePlainText=r.opts.cleanPaste||r._pasteInBlockEl.is("pre, table"),r._pastePlainText?u=r.editor.formatter.clearHtml(r._pasteBin.html(),!0):(u=n("<div/>").append(r._pasteBin.contents()),u.find("style").remove(),u.find("table colgroup").remove(),r.editor.formatter.format(u),r.editor.formatter.decorate(u),r.editor.formatter.beautify(u.children()),u=u.contents()),r._pasteBin.remove(),r._pasteBin=null,t(u)}}(this),0)},i.prototype._processPasteContent=function(t){var i,f,e,r,d,o,h,c,l,g,nt,tt,it,rt,ut,ft,a,v,u,y,p,w,et,b,s,k;if(this.editor.triggerHandler("pasting",[t])!==!1){if(i=this._pasteInBlockEl,t)if(this._pastePlainText)if(i.is("table")){for(a=t.split("\n"),g=a.pop(),c=0,nt=a.length;c<nt;c++)ft=a[c],this.editor.selection.insertNode(document.createTextNode(ft)),this.editor.selection.insertNode(n("<br/>"));this.editor.selection.insertNode(document.createTextNode(g))}else for(t=n("<div/>").text(t),w=t.contents(),l=0,tt=w.length;l<tt;l++)u=w[l],this.editor.selection.insertNode(n(u)[0]);else if(i.is(this.editor.body))for(v=0,it=t.length;v<it;v++)u=t[v],this.editor.selection.insertNode(u);else{if(t.length<1)return;if(t.length===1)if(t.is("p")){if(r=t.contents(),i.is("h1, h2, h3, h4, h5")&&r.length&&r.css("font-size",""),r.length===1&&r.is("img")){if(f=r,/^data:image/.test(f.attr("src"))){if(!this.opts.pasteImage)return;e=this.editor.util.dataURLtoBlob(f.attr("src"));e.name="Clipboard Image.png";s={};s[this.opts.pasteImage]=!0;(et=this.editor.uploader)!=null&&et.upload(e,s);return}if(new RegExp("^blob:"+location.origin+"/").test(f.attr("src"))){if(!this.opts.pasteImage)return;s={};s[this.opts.pasteImage]=!0;d=this.editor.util.dataURLtoBlob;k=this.editor.uploader;o=new Image;o.onload=function(){var n;n=document.createElement("canvas");n.width=o.naturalWidth;n.height=o.naturalHeight;n.getContext("2d").drawImage(o,0,0);e=d(n.toDataURL("image/png"));e.name="Clipboard Image.png";k!==null&&k.upload(e,s)};o.src=f.attr("src");return}if(f.is('img[src^="webkit-fake-url://"]'))return}for(y=0,rt=r.length;y<rt;y++)u=r[y],this.editor.selection.insertNode(u)}else if(i.is("p")&&this.editor.util.isEmptyNode(i))i.replaceWith(t),this.editor.selection.setRangeAtEndOf(t);else if(t.is("ul, ol"))if(t.find("li").length===1)for(t=n("<div/>").text(t.text()),b=t.contents(),p=0,ut=b.length;p<ut;p++)u=b[p],this.editor.selection.insertNode(n(u)[0]);else i.is("li")?(i.parent().after(t),this.editor.selection.setRangeAtEndOf(t)):(i.after(t),this.editor.selection.setRangeAtEndOf(t));else i.after(t),this.editor.selection.setRangeAtEndOf(t);else i.is("li")&&(i=i.parent()),this.editor.selection.rangeAtStartOf(i)?h="before":this.editor.selection.rangeAtEndOf(i)?h="after":(this.editor.selection.breakBlockEl(i),h="before"),i[h](t),this.editor.selection.setRangeAtEndOf(t.last())}else return;return this.editor.inputManager.throttledValueChanged()}},i}(t),f=function(t){function f(){return f.__super__.constructor.apply(this,arguments)}return u(f,t),f.connect(dt),f.connect(ut),f.connect(lt),f.connect(bt),f.connect(et),f.connect(d),f.connect(pt),f.connect(rt),f.connect(y),f.count=0,f.prototype.opts={textarea:null,placeholder:"",defaultImage:"/images/template/image.png",params:{},upload:!1,indentWidth:40},f.prototype._init=function(){var e,t,u;if(this.textarea=n(this.opts.textarea),this.opts.placeholder=this.opts.placeholder||this.textarea.attr("placeholder"),!this.textarea.length)throw new Error("simditor: param textarea is required.");if(t=this.textarea.data("simditor"),t!=null&&t.destroy(),this.id=++f.count,this._render(),i)this.hotkeys=i({el:this.body});else throw new Error("simditor: simple-hotkeys is required.");this.opts.upload&&r&&(u=typeof this.opts.upload=="object"?this.opts.upload:{},this.uploader=r(u));this.on("initialized",function(n){return function(){if(n.opts.placeholder)n.on("valuechanged",function(){return n._placeholder()});return n.setValue(n.textarea.val().trim()||""),n.textarea.attr("autofocus")?n.focus():void 0}}(this));if(this.util.browser.mozilla){this.util.reflow();try{return document.execCommand("enableObjectResizing",!1,!1),document.execCommand("enableInlineTableEditing",!1,!1)}catch(o){e=o}}},f.prototype._tpl='<div class="simditor">\n  <div class="simditor-wrapper">\n    <div class="simditor-placeholder"><\/div>\n    <div class="simditor-body" contenteditable="true">\n    <\/div>\n  <\/div>\n<\/div>',f.prototype._render=function(){var t,i,r,u;if(this.el=n(this._tpl).insertBefore(this.textarea),this.wrapper=this.el.find(".simditor-wrapper"),this.body=this.wrapper.find(".simditor-body"),this.placeholderEl=this.wrapper.find(".simditor-placeholder").append(this.opts.placeholder),this.el.data("simditor",this),this.wrapper.append(this.textarea),this.textarea.data("simditor",this).blur(),this.body.attr("tabindex",this.textarea.attr("tabindex")),this.util.os.mac?this.el.addClass("simditor-mac"):this.util.os.linux&&this.el.addClass("simditor-linux"),this.util.os.mobile&&this.el.addClass("simditor-mobile"),this.opts.params){i=this.opts.params;r=[];for(t in i)u=i[t],r.push(n("<input/>",{type:"hidden",name:t,value:u}).insertAfter(this.textarea));return r}},f.prototype._placeholder=function(){var n;return n=this.body.children(),n.length===0||n.length===1&&this.util.isEmptyNode(n)&&parseInt(n.css("margin-left")||0)<this.opts.indentWidth?this.placeholderEl.show():this.placeholderEl.hide()},f.prototype.setValue=function(n){return this.hidePopover(),this.textarea.val(n),this.body.get(0).innerHTML=n,this.formatter.format(),this.formatter.decorate(),this.util.reflow(this.body),this.inputManager.lastCaretPosition=null,this.trigger("valuechanged")},f.prototype.getValue=function(){return this.sync()},f.prototype.sync=function(){var f,t,u,r,i,e;for(t=this.body.clone(),this.formatter.undecorate(t),this.formatter.format(t),this.formatter.autolink(t),f=t.children(),i=f.last("p"),r=f.first("p");i.is("p")&&this.util.isEmptyNode(i);)u=i,i=i.prev("p"),u.remove();while(r.is("p")&&this.util.isEmptyNode(r))u=r,r=i.next("p"),u.remove();return t.find("img.uploading").remove(),e=n.trim(t.html()),this.textarea.val(e),e},f.prototype.focus=function(){var t,i;if(!(this.body.is(":visible")&&this.body.is("[contenteditable]"))){this.el.find("textarea:visible").focus();return}return this.inputManager.lastCaretPosition?(this.undoManager.caretPosition(this.inputManager.lastCaretPosition),this.inputManager.lastCaretPosition=null):(t=this.body.children().last(),t.is("p")||(t=n("<p/>").append(this.util.phBr).appendTo(this.body)),i=document.createRange(),this.selection.setRangeAtEndOf(t,i))},f.prototype.blur=function(){return this.body.is(":visible")&&this.body.is("[contenteditable]")?this.body.blur():this.body.find("textarea:visible").blur()},f.prototype.hidePopover=function(){return this.el.find(".simditor-popover").each(function(t,i){return i=n(i).data("popover"),i.active?i.hide():void 0})},f.prototype.destroy=function(){return this.triggerHandler("destroy"),this.textarea.closest("form").off(".simditor .simditor-"+this.id),this.selection.clear(),this.inputManager.focused=!1,this.textarea.insertBefore(this.el).hide().val("").removeData("simditor"),this.el.remove(),n(document).off(".simditor-"+this.id),n(window).off(".simditor-"+this.id),this.off()},f}(t),f.i18n={"zh-CN":{blockquote:"引用",bold:"加粗文字",code:"插入代码",color:"文字颜色",coloredText:"彩色文字",hr:"分隔线",image:"插入图片",externalImage:"外链图片",uploadImage:"上传图片",uploadFailed:"上传失败了",uploadError:"上传出错了",imageUrl:"图片地址",imageSize:"图片尺寸",imageAlt:"图片描述",restoreImageSize:"还原图片尺寸",uploading:"正在上传",indent:"向右缩进",outdent:"向左缩进",italic:"斜体文字",link:"插入链接",linkText:"链接文字",linkUrl:"链接地址",linkTarget:"打开方式",openLinkInCurrentWindow:"在当前窗口中打开",openLinkInNewWindow:"在新窗口中打开",removeLink:"移除链接",ol:"有序列表",ul:"无序列表",strikethrough:"删除线文字",table:"表格",deleteRow:"删除行",insertRowAbove:"在上面插入行",insertRowBelow:"在下面插入行",deleteColumn:"删除列",insertColumnLeft:"在左边插入列",insertColumnRight:"在右边插入列",deleteTable:"删除表格",title:"标题",normalText:"普通文本",underline:"下划线文字",alignment:"水平对齐",alignCenter:"居中",alignLeft:"居左",alignRight:"居右",selectLanguage:"选择程序语言",fontScale:"字体大小",fontScaleXLarge:"超大字体",fontScaleLarge:"大号字体",fontScaleNormal:"正常大小",fontScaleSmall:"小号字体",fontScaleXSmall:"超小字体"},"en-US":{blockquote:"Block Quote",bold:"Bold",code:"Code",color:"Text Color",coloredText:"Colored Text",hr:"Horizontal Line",image:"Insert Image",externalImage:"External Image",uploadImage:"Upload Image",uploadFailed:"Upload failed",uploadError:"Error occurs during upload",imageUrl:"Url",imageSize:"Size",imageAlt:"Alt",restoreImageSize:"Restore Origin Size",uploading:"Uploading",indent:"Indent",outdent:"Outdent",italic:"Italic",link:"Insert Link",linkText:"Text",linkUrl:"Url",linkTarget:"Target",openLinkInCurrentWindow:"Open link in current window",openLinkInNewWindow:"Open link in new window",removeLink:"Remove Link",ol:"Ordered List",ul:"Unordered List",strikethrough:"Strikethrough",table:"Table",deleteRow:"Delete Row",insertRowAbove:"Insert Row Above",insertRowBelow:"Insert Row Below",deleteColumn:"Delete Column",insertColumnLeft:"Insert Column Left",insertColumnRight:"Insert Column Right",deleteTable:"Delete Table",title:"Title",normalText:"Text",underline:"Underline",alignment:"Alignment",alignCenter:"Align Center",alignLeft:"Align Left",alignRight:"Align Right",selectLanguage:"Select Language",fontScale:"Font Size",fontScaleXLarge:"X Large Size",fontScaleLarge:"Large Size",fontScaleNormal:"Normal Size",fontScaleSmall:"Small Size",fontScaleXSmall:"X Small Size"}},e=function(t){function i(n){this.editor=n.editor;this.title=this._t(this.name);i.__super__.constructor.call(this,n)}return u(i,t),i.prototype._tpl={item:'<li><a tabindex="-1" unselectable="on" class="toolbar-item" href="javascript:;"><span><\/span><\/a><\/li>',menuWrapper:'<div class="toolbar-menu"><\/div>',menuItem:'<li><a tabindex="-1" unselectable="on" class="menu-item" href="javascript:;"><span><\/span><\/a><\/li>',separator:'<li><span class="separator"><\/span><\/li>'},i.prototype.name="",i.prototype.icon="",i.prototype.title="",i.prototype.text="",i.prototype.htmlTag="",i.prototype.disableTag="",i.prototype.menu=!1,i.prototype.active=!1,i.prototype.disabled=!1,i.prototype.needFocus=!0,i.prototype.shortcut=null,i.prototype._init=function(){var i,u,r,t;this.render();this.el.on("mousedown",function(n){return function(t){var i,r,u;return(t.preventDefault(),r=n.needFocus&&!n.editor.inputManager.focused,n.el.hasClass("disabled"))?!1:(r&&n.editor.focus(),n.menu)?(n.wrapper.toggleClass("menu-on").siblings("li").removeClass("menu-on"),n.wrapper.is(".menu-on")&&(i=n.menuWrapper.offset().left+n.menuWrapper.outerWidth()+5-n.editor.wrapper.offset().left-n.editor.wrapper.outerWidth(),i>0&&n.menuWrapper.css({left:"auto",right:0}),n.trigger("menuexpand")),!1):(u=n.el.data("param"),n.command(u),!1)}}(this));this.wrapper.on("click","a.menu-item",function(t){return function(i){var r,u,f;return(i.preventDefault(),r=n(i.currentTarget),t.wrapper.removeClass("menu-on"),u=t.needFocus&&!t.editor.inputManager.focused,r.hasClass("disabled")||u)?!1:(t.editor.toolbar.wrapper.removeClass("menu-on"),f=r.data("param"),t.command(f),!1)}}(this));this.wrapper.on("mousedown","a.menu-item",function(){return!1});this.editor.on("blur",function(n){return function(){var t;if(t=n.editor.body.is(":visible")&&n.editor.body.is("[contenteditable]"),t&&!n.editor.clipboard.pasting)return n.setActive(!1),n.setDisabled(!1)}}(this));for(this.shortcut!=null&&this.editor.hotkeys.add(this.shortcut,function(n){return function(){return n.el.mousedown(),!1}}(this)),r=this.htmlTag.split(","),i=0,u=r.length;i<u;i++)t=r[i],t=n.trim(t),t&&n.inArray(t,this.editor.formatter._allowedTags)<0&&this.editor.formatter._allowedTags.push(t);return this.editor.on("selectionchanged",function(n){return function(){if(n.editor.inputManager.focused)return n._status()}}(this))},i.prototype.iconClassOf=function(n){return n?"simditor-icon simditor-icon-"+n:""},i.prototype.setIcon=function(n){return this.el.find("span").removeClass().addClass(this.iconClassOf(n)).text(this.text)},i.prototype.render=function(){if(this.wrapper=n(this._tpl.item).appendTo(this.editor.toolbar.list),this.el=this.wrapper.find("a.toolbar-item"),this.el.attr("title",this.title).addClass("toolbar-item-"+this.name).data("button",this),this.setIcon(this.icon),this.menu)return this.menuWrapper=n(this._tpl.menuWrapper).appendTo(this.wrapper),this.menuWrapper.addClass("toolbar-menu-"+this.name),this.renderMenu()},i.prototype.renderMenu=function(){var u,e,i,o,t,f,s,r;if(n.isArray(this.menu)){for(this.menuEl=n("<ul/>").appendTo(this.menuWrapper),f=this.menu,r=[],i=0,o=f.length;i<o;i++){if(t=f[i],t==="|"){n(this._tpl.separator).appendTo(this.menuEl);continue}e=n(this._tpl.menuItem).appendTo(this.menuEl);u=e.find("a.menu-item").attr({title:(s=t.title)!=null?s:t.text,"data-param":t.param}).addClass("menu-item-"+t.name);t.icon?r.push(u.find("span").addClass(this.iconClassOf(t.icon))):r.push(u.find("span").text(t.text))}return r}},i.prototype.setActive=function(n){if(n!==this.active)return this.active=n,this.el.toggleClass("active",this.active)},i.prototype.setDisabled=function(n){if(n!==this.disabled)return this.disabled=n,this.el.toggleClass("disabled",this.disabled)},i.prototype._disableStatus=function(){var n,t,i;return i=this.editor.selection.startNodes(),t=this.editor.selection.endNodes(),n=i.filter(this.disableTag).length>0||t.filter(this.disableTag).length>0,this.setDisabled(n),this.disabled&&this.setActive(!1),this.disabled},i.prototype._activeStatus=function(){var t,i,r,n,u;return u=this.editor.selection.startNodes(),r=this.editor.selection.endNodes(),n=u.filter(this.htmlTag),i=r.filter(this.htmlTag),t=n.length>0&&i.length>0&&n.is(i),this.node=t?n:null,this.setActive(t),this.active},i.prototype._status=function(){if(this._disableStatus(),!this.disabled)return this._activeStatus()},i.prototype.command=function(){},i.prototype._t=function(){var t,r,n;return t=1<=arguments.length?o.call(arguments,0):[],n=i.__super__._t.apply(this,t),n||(n=(r=this.editor)._t.apply(r,t)),n},i}(t),f.Button=e,s=function(t){function i(n){this.button=n.button;this.editor=n.button.editor;i.__super__.constructor.call(this,n)}return u(i,t),i.prototype.offset={top:4,left:0},i.prototype.target=null,i.prototype.active=!1,i.prototype._init=function(){this.el=n('<div class="simditor-popover"><\/div>').appendTo(this.editor.el).data("popover",this);this.render();this.el.on("mouseenter",function(n){return function(){return n.el.addClass("hover")}}(this));return this.el.on("mouseleave",function(n){return function(){return n.el.removeClass("hover")}}(this))},i.prototype.render=function(){},i.prototype._initLabelWidth=function(){var t;if(t=this.el.find(".settings-field"),t.length>0)return this._labelWidth=0,t.each(function(t){return function(i,r){var f,u;if(f=n(r),u=f.find("label"),u.length>0)return t._labelWidth=Math.max(t._labelWidth,u.width())}}(this)),t.find("label").width(this._labelWidth)},i.prototype.show=function(t,i){if(i==null&&(i="bottom"),t!=null)return this.el.siblings(".simditor-popover").each(function(t,i){return i=n(i).data("popover"),i.active?i.hide():void 0}),this.active&&this.target&&this.target.removeClass("selected"),this.target=t.addClass("selected"),this.active?(this.refresh(i),this.trigger("popovershow")):(this.active=!0,this.el.css({left:-9999}).show(),this._labelWidth||this._initLabelWidth(),this.editor.util.reflow(),this.refresh(i),this.trigger("popovershow"))},i.prototype.hide=function(){if(this.active)return this.target&&this.target.removeClass("selected"),this.target=null,this.active=!1,this.el.hide(),this.trigger("popoverhide")},i.prototype.refresh=function(n){var t,u,f,e,i,r;if(n==null&&(n="bottom"),this.active)return t=this.editor.el.offset(),i=this.target.offset(),e=this.target.outerHeight(),n==="bottom"?r=i.top-t.top+e:n==="top"&&(r=i.top-t.top-this.el.height()),f=this.editor.wrapper.width()-this.el.outerWidth()-10,u=Math.min(i.left-t.left,f),this.el.css({top:r+this.offset.top,left:u+this.offset.left})},i.prototype.destroy=function(){return this.target=null,this.active=!1,this.editor.off(".linkpopover"),this.el.remove()},i.prototype._t=function(){var t,r,n;return t=1<=arguments.length?o.call(arguments,0):[],n=i.__super__._t.apply(this,t),n||(n=(r=this.button)._t.apply(r,t)),n},i}(t),f.Popover=s,yt=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return u(i,t),i.prototype.name="title",i.prototype.htmlTag="h1, h2, h3, h4, h5",i.prototype.disableTag="pre, table",i.prototype._init=function(){return this.menu=[{name:"normal",text:this._t("normalText"),param:"p"},"|",{name:"h1",text:this._t("title")+" 1",param:"h1"},{name:"h2",text:this._t("title")+" 2",param:"h2"},{name:"h3",text:this._t("title")+" 3",param:"h3"},{name:"h4",text:this._t("title")+" 4",param:"h4"},{name:"h5",text:this._t("title")+" 5",param:"h5"}],i.__super__._init.call(this)},i.prototype.setActive=function(n,t){return i.__super__.setActive.call(this,n),n&&(t||(t=this.node[0].tagName.toLowerCase())),this.el.removeClass("active-p active-h1 active-h2 active-h3 active-h4 active-h5"),n?this.el.addClass("active active-"+t):void 0},i.prototype.command=function(t){var i;return i=this.editor.selection.rootNodes(),this.editor.selection.save(),i.each(function(i){return function(r,u){var f;if(f=n(u),!f.is("blockquote")&&!f.is(t)&&!f.is(i.disableTag)&&!i.editor.util.isDecoratedNode(f))return n("<"+t+"/>").append(f.contents()).replaceAll(f)}}(this)),this.editor.selection.restore(),this.editor.trigger("valuechanged")},i}(e),f.Toolbar.addButton(yt),k=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return u(i,t),i.prototype.name="fontScale",i.prototype.icon="font",i.prototype.htmlTag="span",i.prototype.disableTag="pre, h1, h2, h3, h4, h5",i.prototype.sizeMap={"x-large":"1.5em",large:"1.25em",small:".75em","x-small":".5em"},i.prototype._init=function(){return this.menu=[{name:"150%",text:this._t("fontScaleXLarge"),param:"5"},{name:"125%",text:this._t("fontScaleLarge"),param:"4"},{name:"100%",text:this._t("fontScaleNormal"),param:"3"},{name:"75%",text:this._t("fontScaleSmall"),param:"2"},{name:"50%",text:this._t("fontScaleXSmall"),param:"1"}],i.__super__._init.call(this)},i.prototype._activeStatus=function(){var i,r,n,f,u,t;return f=this.editor.selection.range(),t=this.editor.selection.startNodes(),n=this.editor.selection.endNodes(),u=t.filter('span[style*="font-size"]'),r=n.filter('span[style*="font-size"]'),i=t.length>0&&n.length>0&&u.is(r),this.setActive(i),this.active},i.prototype.command=function(t){var u,i,r;if(r=this.editor.selection.range(),!r.collapsed)return this.editor.selection.range(r),document.execCommand("styleWithCSS",!1,!0),document.execCommand("fontSize",!1,t),document.execCommand("styleWithCSS",!1,!1),this.editor.selection.reset(),this.editor.selection.range(),i=this.editor.selection.containerNode(),u=i[0].nodeType===Node.TEXT_NODE?i.closest('span[style*="font-size"]'):i.find('span[style*="font-size"]'),u.each(function(t){return function(i,r){var u,f;return(u=n(r),f=r.style.fontSize,/large|x-large|small|x-small/.test(f))?u.css("fontSize",t.sizeMap[f]):f==="medium"?u[0].style.length>1?u.css("fontSize",""):u.replaceWith(u.contents()):void 0}}(this)),this.editor.trigger("valuechanged")},i}(e),f.Toolbar.addButton(k),v=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return u(i,t),i.prototype.name="bold",i.prototype.icon="bold",i.prototype.htmlTag="b, strong",i.prototype.disableTag="pre",i.prototype.shortcut="cmd+b",i.prototype._init=function(){return this.editor.util.os.mac?this.title=this.title+" ( Cmd + b )":(this.title=this.title+" ( Ctrl + b )",this.shortcut="ctrl+b"),i.__super__._init.call(this)},i.prototype._activeStatus=function(){var n;return n=document.queryCommandState("bold")===!0,this.setActive(n),this.active},i.prototype.command=function(){return document.execCommand("bold"),this.editor.util.support.oninput||this.editor.trigger("valuechanged"),n(document).trigger("selectionchange")},i}(e),f.Toolbar.addButton(v),ft=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return u(i,t),i.prototype.name="italic",i.prototype.icon="italic",i.prototype.htmlTag="i",i.prototype.disableTag="pre",i.prototype.shortcut="cmd+i",i.prototype._init=function(){return this.editor.util.os.mac?this.title=this.title+" ( Cmd + i )":(this.title=this.title+" ( Ctrl + i )",this.shortcut="ctrl+i"),i.__super__._init.call(this)},i.prototype._activeStatus=function(){var n;return n=document.queryCommandState("italic")===!0,this.setActive(n),this.active},i.prototype.command=function(){return document.execCommand("italic"),this.editor.util.support.oninput||this.editor.trigger("valuechanged"),n(document).trigger("selectionchange")},i}(e),f.Toolbar.addButton(ft),wt=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return u(i,t),i.prototype.name="underline",i.prototype.icon="underline",i.prototype.htmlTag="u",i.prototype.disableTag="pre",i.prototype.shortcut="cmd+u",i.prototype.render=function(){return this.editor.util.os.mac?this.title=this.title+" ( Cmd + u )":(this.title=this.title+" ( Ctrl + u )",this.shortcut="ctrl+u"),i.__super__.render.call(this)},i.prototype._activeStatus=function(){var n;return n=document.queryCommandState("underline")===!0,this.setActive(n),this.active},i.prototype.command=function(){return document.execCommand("underline"),this.editor.util.support.oninput||this.editor.trigger("valuechanged"),n(document).trigger("selectionchange")},i}(e),f.Toolbar.addButton(wt),b=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return u(i,t),i.prototype.name="color",i.prototype.icon="tint",i.prototype.disableTag="pre",i.prototype.menu=!0,i.prototype.render=function(){var n;return n=1<=arguments.length?o.call(arguments,0):[],i.__super__.render.apply(this,n)},i.prototype.renderMenu=function(){n('<ul class="color-list">\n  <li><a href="javascript:;" class="font-color font-color-1"><\/a><\/li>\n  <li><a href="javascript:;" class="font-color font-color-2"><\/a><\/li>\n  <li><a href="javascript:;" class="font-color font-color-3"><\/a><\/li>\n  <li><a href="javascript:;" class="font-color font-color-4"><\/a><\/li>\n  <li><a href="javascript:;" class="font-color font-color-5"><\/a><\/li>\n  <li><a href="javascript:;" class="font-color font-color-6"><\/a><\/li>\n  <li><a href="javascript:;" class="font-color font-color-7"><\/a><\/li>\n  <li><a href="javascript:;" class="font-color font-color-default"><\/a><\/li>\n<\/ul>').appendTo(this.menuWrapper);this.menuWrapper.on("mousedown",".color-list",function(){return!1});return this.menuWrapper.on("click",".font-color",function(t){return function(i){var u,o,f,r,e,s;if(t.wrapper.removeClass("menu-on"),u=n(i.currentTarget),u.hasClass("font-color-default")){if(o=t.editor.body.find("p, li"),!(o.length>0))return;e=window.getComputedStyle(o[0],null).getPropertyValue("color");f=t._convertRgbToHex(e)}else e=window.getComputedStyle(u[0],null).getPropertyValue("background-color"),f=t._convertRgbToHex(e);if(f)return r=t.editor.selection.range(),!u.hasClass("font-color-default")&&r.collapsed&&(s=document.createTextNode(t._t("coloredText")),r.insertNode(s),r.selectNodeContents(s)),t.editor.selection.range(r),document.execCommand("styleWithCSS",!1,!0),document.execCommand("foreColor",!1,f),document.execCommand("styleWithCSS",!1,!1),t.editor.util.support.oninput?void 0:t.editor.trigger("valuechanged")}}(this))},i.prototype._convertRgbToHex=function(n){var t,i,r;return(i=/rgb\((\d+),\s?(\d+),\s?(\d+)\)/g,t=i.exec(n),!t)?"":(r=function(n,t,i){var r;return r=function(n){var t;return t=n.toString(16),t.length===1?"0"+t:t},"#"+r(n)+r(t)+r(i)},r(t[1]*1,t[2]*1,t[3]*1))},i}(e),f.Toolbar.addButton(b),c=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return u(i,t),i.prototype.type="",i.prototype.disableTag="pre, table",i.prototype.command=function(){var t,i,r;return i=this.editor.selection.blockNodes(),r=this.type==="ul"?"ol":"ul",this.editor.selection.save(),t=null,i.each(function(i){return function(u,f){var e;if(e=n(f),!e.is("blockquote, li")&&!e.is(i.disableTag)&&!i.editor.util.isDecoratedNode(e)&&n.contains(document,f))return e.is(i.type)?(e.children("li").each(function(t,r){var f,u;return u=n(r),f=u.children("ul, ol").insertAfter(e),n("<p/>").append(n(r).html()||i.editor.util.phBr).insertBefore(e)}),e.remove()):e.is(r)?n("<"+i.type+"/>").append(e.contents()).replaceAll(e):t&&e.prev().is(t)?(n("<li/>").append(e.html()||i.editor.util.phBr).appendTo(t),e.remove()):(t=n("<"+i.type+"><li><\/li><\/"+i.type+">"),t.find("li").append(e.html()||i.editor.util.phBr),t.replaceAll(e))}}(this)),this.editor.selection.restore(),this.editor.trigger("valuechanged")},i}(e),ht=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return u(t,n),t.prototype.type="ol",t.prototype.name="ol",t.prototype.icon="list-ol",t.prototype.htmlTag="ol",t.prototype.shortcut="cmd+/",t.prototype._init=function(){return this.editor.util.os.mac?this.title=this.title+" ( Cmd + / )":(this.title=this.title+" ( ctrl + / )",this.shortcut="ctrl+/"),t.__super__._init.call(this)},t}(c),kt=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return u(t,n),t.prototype.type="ul",t.prototype.name="ul",t.prototype.icon="list-ul",t.prototype.htmlTag="ul",t.prototype.shortcut="cmd+.",t.prototype._init=function(){return this.editor.util.os.mac?this.title=this.title+" ( Cmd + . )":(this.title=this.title+" ( Ctrl + . )",this.shortcut="ctrl+."),t.__super__._init.call(this)},t}(c),f.Toolbar.addButton(ht),f.Toolbar.addButton(kt),a=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return u(i,t),i.prototype.name="blockquote",i.prototype.icon="quote-left",i.prototype.htmlTag="blockquote",i.prototype.disableTag="pre, table",i.prototype.command=function(){var i,r,t;return i=this.editor.selection.rootNodes(),i=i.filter(function(t,i){return!n(i).parent().is("blockquote")}),this.editor.selection.save(),t=[],r=function(i){return function(){if(t.length>0)return n("<"+i.htmlTag+"/>").insertBefore(t[0]).append(t),t.length=0}}(this),i.each(function(i){return function(u,f){var e;if(e=n(f),e.parent().is(i.editor.body))return e.is(i.htmlTag)?(r(),e.children().unwrap()):e.is(i.disableTag)||i.editor.util.isDecoratedNode(e)?r():t.push(f)}}(this)),r(),this.editor.selection.restore(),this.editor.trigger("valuechanged")},i}(e),f.Toolbar.addButton(a),p=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return u(i,t),i.prototype.name="code",i.prototype.icon="code",i.prototype.htmlTag="pre",i.prototype.disableTag="ul, ol, table",i.prototype._init=function(){i.__super__._init.call(this);this.editor.on("decorate",function(t){return function(i,r){return r.find("pre").each(function(i,r){return t.decorate(n(r))})}}(this));return this.editor.on("undecorate",function(t){return function(i,r){return r.find("pre").each(function(i,r){return t.undecorate(n(r))})}}(this))},i.prototype.render=function(){var n;return n=1<=arguments.length?o.call(arguments,0):[],i.__super__.render.apply(this,n),this.popover=new w({button:this})},i.prototype._checkMode=function(){var i,t;return t=this.editor.selection.range(),(i=n(t.cloneContents()).find(this.editor.util.blockNodes.join(",")))>0||t.collapsed&&this.editor.selection.startNodes().filter("code").length===0?(this.inlineMode=!1,this.htmlTag="pre"):(this.inlineMode=!0,this.htmlTag="code")},i.prototype._status=function(){if(this._checkMode(),i.__super__._status.call(this),!this.inlineMode)return this.active?this.popover.show(this.node):this.popover.hide()},i.prototype.decorate=function(n){var t,i,r,u;return t=n.find("> code"),t.length>0&&(i=(r=t.attr("class"))!=null?(u=r.match(/lang-(\S+)/))!=null?u[1]:void 0:void 0,t.contents().unwrap(),i)?n.attr("data-lang",i):void 0},i.prototype.undecorate=function(t){var r,i;return i=t.attr("data-lang"),r=n("<code/>"),i&&i!==-1&&r.addClass("lang-"+i),t.wrapInner(r).removeAttr("data-lang")},i.prototype.command=function(){return this.inlineMode?this._inlineCommand():this._blockCommand()},i.prototype._blockCommand=function(){var u,i,t,r;return u=this.editor.selection.rootNodes(),t=[],r=[],i=function(i){return function(){var u;if((t.length>0))return u=n("<"+i.htmlTag+"/>").insertBefore(t[0]).text(i.editor.formatter.clearHtml(t)),r.push(u[0]),t.length=0}}(this),u.each(function(u){return function(f,e){var o,s;return o=n(e),o.is(u.htmlTag)?(i(),s=n("<p/>").append(o.html().replace("\n","<br/>")).replaceAll(o),r.push(s[0])):o.is(u.disableTag)||u.editor.util.isDecoratedNode(o)||o.is("blockquote")?i():t.push(e)}}(this)),i(),this.editor.selection.setRangeAtEndOf(n(r).last()),this.editor.trigger("valuechanged")},i.prototype._inlineCommand=function(){var i,r,t;return t=this.editor.selection.range(),this.active?(t.selectNodeContents(this.node[0]),this.editor.selection.save(t),this.node.contents().unwrap(),this.editor.selection.restore()):(r=n(t.extractContents()),i=n("<"+this.htmlTag+"/>").append(r.contents()),t.insertNode(i[0]),t.selectNodeContents(i[0]),this.editor.selection.range(t)),this.editor.trigger("valuechanged")},i}(e),w=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return u(i,t),i.prototype.render=function(){var f,t,i,u,r;for(this._tpl='<div class="code-settings">\n  <div class="settings-field">\n    <select class="select-lang">\n      <option value="-1">'+this._t("selectLanguage")+"<\/option>\n    <\/select>\n  <\/div>\n<\/div>",this.langs=this.editor.opts.codeLanguages||[{name:"Bash",value:"bash"},{name:"C++",value:"c++"},{name:"C#",value:"cs"},{name:"CSS",value:"css"},{name:"Erlang",value:"erlang"},{name:"Less",value:"less"},{name:"Sass",value:"sass"},{name:"Diff",value:"diff"},{name:"CoffeeScript",value:"coffeescript"},{name:"HTML,XML",value:"html"},{name:"JSON",value:"json"},{name:"Java",value:"java"},{name:"JavaScript",value:"js"},{name:"Markdown",value:"markdown"},{name:"Objective C",value:"oc"},{name:"PHP",value:"php"},{name:"Perl",value:"parl"},{name:"Python",value:"python"},{name:"Ruby",value:"ruby"},{name:"SQL",value:"sql"}],this.el.addClass("code-popover").append(this._tpl),this.selectEl=this.el.find(".select-lang"),r=this.langs,t=0,u=r.length;t<u;t++)i=r[t],f=n("<option/>",{text:i.name,value:i.value}).appendTo(this.selectEl);this.selectEl.on("change",function(n){return function(){var t;return n.lang=n.selectEl.val(),t=n.target.hasClass("selected"),n.target.removeClass().removeAttr("data-lang"),n.lang!==-1&&n.target.attr("data-lang",n.lang),t&&n.target.addClass("selected"),n.editor.trigger("valuechanged")}}(this));return this.editor.on("valuechanged",function(n){return function(){if(n.active)return n.refresh()}}(this))},i.prototype.show=function(){var n;return n=1<=arguments.length?o.call(arguments,0):[],i.__super__.show.apply(this,n),this.lang=this.target.attr("data-lang"),this.lang!=null?this.selectEl.val(this.lang):this.selectEl.val(-1)},i}(s),f.Toolbar.addButton(p),ot=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return u(i,t),i.prototype.name="link",i.prototype.icon="link",i.prototype.htmlTag="a",i.prototype.disableTag="pre",i.prototype.render=function(){var n;return n=1<=arguments.length?o.call(arguments,0):[],i.__super__.render.apply(this,n),this.popover=new st({button:this})},i.prototype._status=function(){return i.__super__._status.call(this),this.active&&!this.editor.selection.rangeAtEndOf(this.node)?this.popover.show(this.node):this.popover.hide()},i.prototype.command=function(){var f,i,e,r,t,u;if(t=this.editor.selection.range(),this.active)u=document.createTextNode(this.node.text()),this.node.replaceWith(u),t.selectNode(u);else{f=n(t.extractContents());r=this.editor.formatter.clearHtml(f.contents(),!1);i=n("<a/>",{href:"",target:"_blank",text:r||this._t("linkText")});this.editor.selection.blockNodes().length>0?t.insertNode(i[0]):(e=n("<p/>").append(i),t.insertNode(e[0]));t.selectNodeContents(i[0]);this.popover.one("popovershow",function(n){return function(){return r?(n.popover.urlEl.focus(),n.popover.urlEl[0].select()):(n.popover.textEl.focus(),n.popover.textEl[0].select())}}(this))}return this.editor.selection.range(t),this.editor.trigger("valuechanged")},i}(e),st=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return u(i,t),i.prototype.render=function(){var t;t='<div class="link-settings">\n  <div class="settings-field">\n    <label>'+this._t("linkText")+'<\/label>\n    <input class="link-text" type="text"/>\n    <a class="btn-unlink" href="javascript:;" title="'+this._t("removeLink")+'"\n      tabindex="-1">\n      <span class="simditor-icon simditor-icon-unlink"><\/span>\n    <\/a>\n  <\/div>\n  <div class="settings-field">\n    <label>'+this._t("linkUrl")+'<\/label>\n    <input class="link-url" type="text"/>\n  <\/div>\n  <div class="settings-field">\n    <label>'+this._t("linkTarget")+'<\/label>\n    <select class="link-target">\n      <option value="_blank">'+this._t("openLinkInNewWindow")+' (_blank)<\/option>\n      <option value="_self">'+this._t("openLinkInCurrentWindow")+" (_self)<\/option>\n    <\/select>\n  <\/div>\n<\/div>";this.el.addClass("link-popover").append(t);this.textEl=this.el.find(".link-text");this.urlEl=this.el.find(".link-url");this.unlinkEl=this.el.find(".btn-unlink");this.selectTarget=this.el.find(".link-target");this.textEl.on("keyup",function(n){return function(t){if(t.which!==13)return n.target.text(n.textEl.val()),n.editor.inputManager.throttledValueChanged()}}(this));this.urlEl.on("keyup",function(n){return function(t){var i;if(t.which!==13)return i=n.urlEl.val(),/https?:\/\/|^\//ig.test(i)||!i||(i="http://"+i),n.target.attr("href",i),n.editor.inputManager.throttledValueChanged()}}(this));n([this.urlEl[0],this.textEl[0]]).on("keydown",function(t){return function(i){var r;if(i.which===13||i.which===27||!i.shiftKey&&i.which===9&&n(i.target).hasClass("link-url"))return i.preventDefault(),r=document.createRange(),t.editor.selection.setRangeAfter(t.target,r),t.hide(),t.editor.inputManager.throttledValueChanged()}}(this));this.unlinkEl.on("click",function(n){return function(){var i,t;return t=document.createTextNode(n.target.text()),n.target.replaceWith(t),n.hide(),i=document.createRange(),n.editor.selection.setRangeAfter(t,i),n.editor.inputManager.throttledValueChanged()}}(this));return this.selectTarget.on("change",function(n){return function(){return n.target.attr("target",n.selectTarget.val()),n.editor.inputManager.throttledValueChanged()}}(this))},i.prototype.show=function(){var n;return n=1<=arguments.length?o.call(arguments,0):[],i.__super__.show.apply(this,n),this.textEl.val(this.target.text()),this.urlEl.val(this.target.attr("href"))},i}(s),f.Toolbar.addButton(ot),nt=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return u(i,t),i.prototype.name="image",i.prototype.icon="picture-o",i.prototype.htmlTag="img",i.prototype.disableTag="pre, table",i.prototype.defaultImage="",i.prototype.needFocus=!1,i.prototype._init=function(){var r,t,f,u;if(this.editor.opts.imageButton)if(Array.isArray(this.editor.opts.imageButton))for(this.menu=[],u=this.editor.opts.imageButton,t=0,f=u.length;t<f;t++)r=u[t],this.menu.push({name:r+"-image",text:this._t(r+"Image")});else this.menu=!1;else this.menu=this.editor.uploader!=null?[{name:"upload-image",text:this._t("uploadImage")},{name:"external-image",text:this._t("externalImage")}]:!1;this.defaultImage=this.editor.opts.defaultImage;this.editor.body.on("click","img:not([data-non-image])",function(t){return function(i){var u,r;return u=n(i.currentTarget),r=document.createRange(),r.selectNode(u[0]),t.editor.selection.range(r),t.editor.util.support.onselectionchange||t.editor.trigger("selectionchanged"),!1}}(this));this.editor.body.on("mouseup","img:not([data-non-image])",function(){return!1});this.editor.on("selectionchanged.image",function(t){return function(){var r,u,i;if(i=t.editor.selection.range(),i!=null)return r=n(i.cloneContents()).contents(),r.length===1&&r.is("img:not([data-non-image])")?(u=n(i.startContainer).contents().eq(i.startOffset),t.popover.show(u)):t.popover.hide()}}(this));this.editor.on("valuechanged.image",function(t){return function(){var i;if(i=t.editor.wrapper.find(".simditor-image-loading"),i.length>0)return i.each(function(i,r){var u,e,f;return e=n(r),u=e.data("img"),!(u&&u.parent().length>0)&&(e.remove(),u&&(f=u.data("file"),f&&(t.editor.uploader.cancel(f),t.editor.body.find("img.uploading").length<1)))?t.editor.uploader.trigger("uploadready",[f]):void 0})}}(this));return i.__super__._init.call(this)},i.prototype.render=function(){var n;return n=1<=arguments.length?o.call(arguments,0):[],i.__super__.render.apply(this,n),this.popover=new tt({button:this}),this.editor.opts.imageButton==="upload"?this._initUploader(this.el):void 0},i.prototype.renderMenu=function(){return i.__super__.renderMenu.call(this),this._initUploader()},i.prototype._initUploader=function(t){var i,r,u;if(t==null&&(t=this.menuEl.find(".menu-item-upload-image")),this.editor.uploader==null){this.el.find(".btn-upload").remove();return}i=null;r=function(r){return function(){return i&&i.remove(),i=n("<input/>",{type:"file",title:r._t("uploadImage"),multiple:!0,accept:"image/gif,image/jpeg,image/jpg,image/png,image/svg"}).appendTo(t)}}(this);r();t.on("click mousedown","input[type=file]",function(n){return n.stopPropagation()});t.on("change","input[type=file]",function(n){return function(){if(n.editor.inputManager.focused)n.editor.uploader.upload(i,{inline:!0}),r();else{n.editor.one("focus",function(){return n.editor.uploader.upload(i,{inline:!0}),r()});n.editor.focus()}return n.wrapper.removeClass("menu-on")}}(this));this.editor.uploader.on("beforeupload",function(t){return function(i,r){var u;if(r.inline)return r.img?u=n(r.img):(u=t.createImage(r.name),r.img=u),u.addClass("uploading"),u.data("file",r),t.editor.uploader.readImageFile(r.obj,function(n){var i;if(u.hasClass("uploading"))return i=n?n.src:t.defaultImage,t.loadImage(u,i,function(){if(t.popover.active)return t.popover.refresh(),t.popover.srcEl.val(t._t("uploading")).prop("disabled",!0)})})}}(this));u=n.proxy(this.editor.util.throttle(function(n,t,i,r){var e,f,u;if(t.inline&&(f=t.img.data("mask"),f)){if(e=f.data("img"),!(e.hasClass("uploading")&&e.parent().length>0)){f.remove();return}return u=i/r,u=(u*100).toFixed(0),u>99&&(u=99),f.find(".progress").height(100-u+"%")}},500),this);this.editor.uploader.on("uploadprogress",u);this.editor.uploader.on("uploadsuccess",function(t){return function(i,r,u){var f,e,o;if(r.inline&&(f=r.img,f.hasClass("uploading")&&f.parent().length>0)){if(typeof u!="object")try{u=n.parseJSON(u)}catch(s){i=s;u={success:!1}}return u.success===!1?(o=u.msg||t._t("uploadFailed"),alert(o),e=t.defaultImage):e=u.file_path,t.loadImage(f,e,function(){var n;return f.removeData("file"),f.removeClass("uploading").removeClass("loading"),n=f.data("mask"),n&&n.remove(),f.removeData("mask"),t.editor.trigger("valuechanged"),t.editor.body.find("img.uploading").length<1?t.editor.uploader.trigger("uploadready",[r,u]):void 0}),t.popover.active?(t.popover.srcEl.prop("disabled",!1),t.popover.srcEl.val(u.file_path)):void 0}}}(this));return this.editor.uploader.on("uploaderror",function(t){return function(i,r,u){var f,o,e;if(r.inline&&u.statusText!=="abort"){if(u.responseText)try{e=n.parseJSON(u.responseText);o=e.msg}catch(s){i=s;o=t._t("uploadError")}if(f=r.img,f.hasClass("uploading")&&f.parent().length>0)return t.loadImage(f,t.defaultImage,function(){var n;return f.removeData("file"),f.removeClass("uploading").removeClass("loading"),n=f.data("mask"),n&&n.remove(),f.removeData("mask")}),t.popover.active&&(t.popover.srcEl.prop("disabled",!1),t.popover.srcEl.val(t.defaultImage)),t.editor.trigger("valuechanged"),t.editor.body.find("img.uploading").length<1?t.editor.uploader.trigger("uploadready",[r,e]):void 0}}}(this))},i.prototype._status=function(){return this._disableStatus()},i.prototype.loadImage=function(t,i,r){var u,f,e;return e=function(n){return function(){var i,r;return i=t.offset(),r=n.editor.wrapper.offset(),u.css({top:i.top-r.top,left:i.left-r.left,width:t.width(),height:t.height()}).show()}}(this),t.addClass("loading"),u=t.data("mask"),u||(u=n('<div class="simditor-image-loading">\n  <div class="progress"><\/div>\n<\/div>').hide().appendTo(this.editor.wrapper),e(),t.data("mask",u),u.data("img",t)),f=new Image,f.onload=function(o){return function(){var s,h;if(t.hasClass("loading")||t.hasClass("uploading"))return h=f.width,s=f.height,t.attr({src:i,width:h,height:s,"data-image-size":h+","+s}).removeClass("loading"),t.hasClass("uploading")?(o.editor.util.reflow(o.editor.body),e()):(u.remove(),t.removeData("mask")),n.isFunction(r)?r(f):void 0}}(this),f.onerror=function(){return n.isFunction(r)&&r(!1),u.remove(),t.removeData("mask").removeClass("loading")},f.src=i},i.prototype.createImage=function(t){var r,i;return t==null&&(t="Image"),this.editor.inputManager.focused||this.editor.focus(),i=this.editor.selection.range(),i.deleteContents(),this.editor.selection.range(i),r=n("<img/>").attr("alt",t),i.insertNode(r[0]),this.editor.selection.setRangeAfter(r,i),this.editor.trigger("valuechanged"),r},i.prototype.command=function(n){var t;return t=this.createImage(),this.loadImage(t,n||this.defaultImage,function(n){return function(){n.editor.trigger("valuechanged");n.editor.util.reflow(t);t.click();return n.popover.one("popovershow",function(){return n.popover.srcEl.focus(),n.popover.srcEl[0].select()})}}(this))},i}(e),tt=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return u(i,t),i.prototype.offset={top:6,left:-4},i.prototype.render=function(){var t;t='<div class="link-settings">\n  <div class="settings-field">\n    <label>'+this._t("imageUrl")+'<\/label>\n    <input class="image-src" type="text" tabindex="1" />\n    <a class="btn-upload" href="javascript:;"\n      title="'+this._t("uploadImage")+'" tabindex="-1">\n      <span class="simditor-icon simditor-icon-upload"><\/span>\n    <\/a>\n  <\/div>\n  <div class=\'settings-field\'>\n    <label>'+this._t("imageAlt")+'<\/label>\n    <input class="image-alt" id="image-alt" type="text" tabindex="1" />\n  <\/div>\n  <div class="settings-field">\n    <label>'+this._t("imageSize")+'<\/label>\n    <input class="image-size" id="image-width" type="text" tabindex="2" />\n    <span class="times">×<\/span>\n    <input class="image-size" id="image-height" type="text" tabindex="3" />\n    <a class="btn-restore" href="javascript:;"\n      title="'+this._t("restoreImageSize")+'" tabindex="-1">\n      <span class="simditor-icon simditor-icon-undo"><\/span>\n    <\/a>\n  <\/div>\n<\/div>';this.el.addClass("image-popover").append(t);this.srcEl=this.el.find(".image-src");this.widthEl=this.el.find("#image-width");this.heightEl=this.el.find("#image-height");this.altEl=this.el.find("#image-alt");this.srcEl.on("keydown",function(n){return function(t){var i;if((t.which===13&&!n.target.hasClass("uploading")))return t.preventDefault(),i=document.createRange(),n.button.editor.selection.setRangeAfter(n.target,i),n.hide()}}(this));this.srcEl.on("blur",function(n){return function(){return n._loadImage(n.srcEl.val())}}(this));this.el.find(".image-size").on("blur",function(t){return function(i){return t._resizeImg(n(i.currentTarget)),t.el.data("popover").refresh()}}(this));this.el.find(".image-size").on("keyup",function(t){return function(i){var r;return r=n(i.currentTarget),(i.which===13||i.which===27||i.which===9)?void 0:t._resizeImg(r,!0)}}(this));this.el.find(".image-size").on("keydown",function(t){return function(i){var r,u,f;return(u=n(i.currentTarget),i.which===13||i.which===27)?(i.preventDefault(),i.which===13?t._resizeImg(u):t._restoreImg(),r=t.target,t.hide(),f=document.createRange(),t.button.editor.selection.setRangeAfter(r,f)):i.which===9?t.el.data("popover").refresh():void 0}}(this));this.altEl.on("keydown",function(n){return function(t){var i;if(t.which===13)return t.preventDefault(),i=document.createRange(),n.button.editor.selection.setRangeAfter(n.target,i),n.hide()}}(this));this.altEl.on("keyup",function(n){return function(t){if(t.which!==13&&t.which!==27&&t.which!==9)return n.alt=n.altEl.val(),n.target.attr("alt",n.alt)}}(this));this.el.find(".btn-restore").on("click",function(n){return function(){return n._restoreImg(),n.el.data("popover").refresh()}}(this));this.editor.on("valuechanged",function(n){return function(){if(n.active)return n.refresh()}}(this));return this._initUploader()},i.prototype._initUploader=function(){var t,i;if(t=this.el.find(".btn-upload"),this.editor.uploader==null){t.remove();return}i=function(i){return function(){return i.input&&i.input.remove(),i.input=n("<input/>",{type:"file",title:i._t("uploadImage"),multiple:!0,accept:"image/gif,image/jpeg,image/jpg,image/png,image/svg"}).appendTo(t)}}(this);i();this.el.on("click mousedown","input[type=file]",function(n){return n.stopPropagation()});return this.el.on("change","input[type=file]",function(n){return function(){return n.editor.uploader.upload(n.input,{inline:!0,img:n.target}),i()}}(this))},i.prototype._resizeImg=function(t,i){var u,r,f;if(i==null&&(i=!1),r=t.val()*1,this.target&&(n.isNumeric(r)||r<0))return t.is(this.widthEl)?(f=r,u=this.height*r/this.width,this.heightEl.val(u)):(u=r,f=this.width*r/this.height,this.widthEl.val(f)),i?void 0:(this.target.attr({width:f,height:u}),this.editor.trigger("valuechanged"))},i.prototype._restoreImg=function(){var t,n;return n=((t=this.target.data("image-size"))!=null?t.split(","):void 0)||[this.width,this.height],this.target.attr({width:n[0]*1,height:n[1]*1}),this.widthEl.val(n[0]),this.heightEl.val(n[1]),this.editor.trigger("valuechanged")},i.prototype._loadImage=function(n,t){if(/^data:image/.test(n)&&!this.editor.uploader){t&&t(!1);return}if(this.target.attr("src")!==n)return this.button.loadImage(this.target,n,function(i){return function(r){var u;if(r)return i.active&&(i.width=r.width,i.height=r.height,i.widthEl.val(i.width),i.heightEl.val(i.height)),/^data:image/.test(n)?(u=i.editor.util.dataURLtoBlob(n),u.name="Base64 Image.png",i.editor.uploader.upload(u,{inline:!0,img:i.target})):i.editor.trigger("valuechanged"),t?t(r):void 0}}(this))},i.prototype.show=function(){var n,t;return t=1<=arguments.length?o.call(arguments,0):[],i.__super__.show.apply(this,t),n=this.target,this.width=n.width(),this.height=n.height(),this.alt=n.attr("alt"),n.hasClass("uploading")?this.srcEl.val(this._t("uploading")).prop("disabled",!0):(this.srcEl.val(n.attr("src")).prop("disabled",!1),this.widthEl.val(this.width),this.heightEl.val(this.height),this.altEl.val(this.alt))},i}(s),f.Toolbar.addButton(nt),it=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return u(t,n),t.prototype.name="indent",t.prototype.icon="indent",t.prototype._init=function(){var n;return n=this.editor.opts.tabIndent===!1?"":" (Tab)",this.title=this._t(this.name)+n,t.__super__._init.call(this)},t.prototype._status=function(){},t.prototype.command=function(){return this.editor.indentation.indent()},t}(e),f.Toolbar.addButton(it),ct=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return u(t,n),t.prototype.name="outdent",t.prototype.icon="outdent",t.prototype._init=function(){var n;return n=this.editor.opts.tabIndent===!1?"":" (Shift + Tab)",this.title=this._t(this.name)+n,t.__super__._init.call(this)},t.prototype._status=function(){},t.prototype.command=function(){return this.editor.indentation.indent(!0)},t}(e),f.Toolbar.addButton(ct),g=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return u(i,t),i.prototype.name="hr",i.prototype.icon="minus",i.prototype.htmlTag="hr",i.prototype._status=function(){},i.prototype.command=function(){var r,t,u,i;return i=this.editor.selection.rootNodes().first(),u=i.next(),u.length>0?this.editor.selection.save():t=n("<p/>").append(this.editor.util.phBr),r=n("<hr/>").insertAfter(i),t?(t.insertAfter(r),this.editor.selection.setRangeAtStartOf(t)):this.editor.selection.restore(),this.editor.trigger("valuechanged")},i}(e),f.Toolbar.addButton(g),vt=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return u(i,t),i.prototype.name="table",i.prototype.icon="table",i.prototype.htmlTag="table",i.prototype.disableTag="pre, li, blockquote",i.prototype.menu=!0,i.prototype._init=function(){i.__super__._init.call(this);n.merge(this.editor.formatter._allowedTags,["thead","th","tbody","tr","td","colgroup","col"]);n.extend(this.editor.formatter._allowedAttributes,{td:["rowspan","colspan"],col:["width"]});n.extend(this.editor.formatter._allowedStyles,{td:["text-align"],th:["text-align"]});this._initShortcuts();this._initResize();this.editor.on("decorate",function(t){return function(i,r){return r.find("table").each(function(i,r){return t.decorate(n(r))})}}(this));this.editor.on("undecorate",function(t){return function(i,r){return r.find("table").each(function(i,r){return t.undecorate(n(r))})}}(this));this.editor.on("selectionchanged.table",function(n){return function(){var t,i;if(n.editor.body.find(".simditor-table td, .simditor-table th").removeClass("active"),i=n.editor.selection.range(),i)return t=n.editor.selection.containerNode(),i.collapsed&&t.is(".simditor-table")&&(t=n.editor.selection.rangeAtStartOf(t)?t.find("th:first"):t.find("td:last"),n.editor.selection.setRangeAtEndOf(t)),t.closest("td, th",n.editor.body).addClass("active")}}(this));this.editor.on("blur.table",function(n){return function(){return n.editor.body.find(".simditor-table td, .simditor-table th").removeClass("active")}}(this));return this.editor.keystroke.add("up","td",function(n){return function(t,i){return n._tdNav(i,"up"),!0}}(this)),this.editor.keystroke.add("up","th",function(n){return function(t,i){return n._tdNav(i,"up"),!0}}(this)),this.editor.keystroke.add("down","td",function(n){return function(t,i){return n._tdNav(i,"down"),!0}}(this)),this.editor.keystroke.add("down","th",function(n){return function(t,i){return n._tdNav(i,"down"),!0}}(this))},i.prototype._tdNav=function(n,t){var i,r,f,o,e,s,u;return(t==null&&(t="up"),f=t==="up"?"prev":"next",u=t==="up"?["tbody","thead"]:["thead","tbody"],s=u[0],o=u[1],r=n.parent("tr"),i=this["_"+f+"Row"](r),!(i.length>0))?!0:(e=r.find("td, th").index(n),this.editor.selection.setRangeAtEndOf(i.find("td, th").eq(e)))},i.prototype._nextRow=function(n){var t;return t=n.next("tr"),t.length<1&&n.parent("thead").length>0&&(t=n.parent("thead").next("tbody").find("tr:first")),t},i.prototype._prevRow=function(n){var t;return t=n.prev("tr"),t.length<1&&n.parent("tbody").length>0&&(t=n.parent("tbody").prev("thead").find("tr")),t},i.prototype._initResize=function(){var t=this.editor;n(document).on("mousemove.simditor-table",".simditor-table td, .simditor-table th",function(t){var f,e,r,i,u,o,s,h,c;if(u=n(this).parents(".simditor-table"),r=u.find(".simditor-resize-handle"),e=u.find("colgroup"),!u.hasClass("resizing")){if(i=n(t.currentTarget),c=t.pageX-n(t.currentTarget).offset().left,c<5&&i.prev().length>0&&(i=i.prev()),i.next("td, th").length<1){r.hide();return}if((s=r.data("td"))!=null?s.is(i):void 0){r.show();return}if(o=i.parent().find("td, th").index(i),f=e.find("col").eq(o),(h=r.data("col"))!=null?h.is(f):void 0){r.show();return}return r.css("left",i.position().left+i.outerWidth()-5).data("td",i).data("col",f).show()}});n(document).on("mouseleave.simditor-table",".simditor-table",function(){return n(this).find(".simditor-resize-handle").hide()});return n(document).on("mousedown.simditor-resize-handle",".simditor-resize-handle",function(i){var u,s,f,l,a,h,r,v,e,o,y,c;h=n(this).parent(".simditor-table");u=n(i.currentTarget);f=u.data("td");s=u.data("col");a=f.next("td, th");l=s.next("col");y=i.pageX;e=f.outerWidth()*1;o=a.outerWidth()*1;v=parseFloat(u.css("left"));c=f.closest("table").width();r=50;n(document).on("mousemove.simditor-resize-table",function(n){var t,i,f;return t=n.pageX-y,i=e+t,f=o-t,i<r?(i=r,t=r-e,f=o-t):f<r&&(f=r,t=o-r,i=e+t),s.attr("width",i/c*100+"%"),l.attr("width",f/c*100+"%"),u.css("left",v+t)});n(document).one("mouseup.simditor-resize-table",function(){return t.sync(),n(document).off(".simditor-resize-table"),h.removeClass("resizing")});return h.addClass("resizing"),!1})},i.prototype._initShortcuts=function(){return this.editor.hotkeys.add("ctrl+alt+up",function(n){return function(){return n.editMenu.find(".menu-item[data-param=insertRowAbove]").click(),!1}}(this)),this.editor.hotkeys.add("ctrl+alt+down",function(n){return function(){return n.editMenu.find(".menu-item[data-param=insertRowBelow]").click(),!1}}(this)),this.editor.hotkeys.add("ctrl+alt+left",function(n){return function(){return n.editMenu.find(".menu-item[data-param=insertColLeft]").click(),!1}}(this)),this.editor.hotkeys.add("ctrl+alt+right",function(n){return function(){return n.editMenu.find(".menu-item[data-param=insertColRight]").click(),!1}}(this))},i.prototype.decorate=function(t){var i,u,o,f,r,e;return t.parent(".simditor-table").length>0&&this.undecorate(t),t.wrap('<div class="simditor-table"><\/div>'),e=t.parent(".simditor-table"),i=t.find("colgroup"),t.find("thead").length<1&&(r=n("<thead />"),u=t.find("tr").first(),r.append(u),this._changeCellTag(u,"th"),f=t.find("tbody"),f.length>0?f.before(r):t.prepend(r)),i.length<1&&(i=n("<colgroup/>").prependTo(t),t.find("thead tr th").each(function(){return n("<col/>").appendTo(i)}),this.refreshTableWidth(t)),o=n("<div />",{"class":"simditor-resize-handle",contenteditable:"false"}).appendTo(e),t.parent()},i.prototype.undecorate=function(n){if((n.parent(".simditor-table").length>0))return n.parent().replaceWith(n)},i.prototype.renderMenu=function(){var t;n('<div class="menu-create-table">\n<\/div>\n<div class="menu-edit-table">\n  <ul>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="deleteRow">\n        <span>'+this._t("deleteRow")+'<\/span>\n      <\/a>\n    <\/li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertRowAbove">\n        <span>'+this._t("insertRowAbove")+' ( Ctrl + Alt + ↑ )<\/span>\n      <\/a>\n    <\/li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertRowBelow">\n        <span>'+this._t("insertRowBelow")+' ( Ctrl + Alt + ↓ )<\/span>\n      <\/a>\n    <\/li>\n    <li><span class="separator"><\/span><\/li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="deleteCol">\n        <span>'+this._t("deleteColumn")+'<\/span>\n      <\/a>\n    <\/li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertColLeft">\n        <span>'+this._t("insertColumnLeft")+' ( Ctrl + Alt + ← )<\/span>\n      <\/a>\n    <\/li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertColRight">\n        <span>'+this._t("insertColumnRight")+' ( Ctrl + Alt + → )<\/span>\n      <\/a>\n    <\/li>\n    <li><span class="separator"><\/span><\/li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="deleteTable">\n        <span>'+this._t("deleteTable")+"<\/span>\n      <\/a>\n    <\/li>\n  <\/ul>\n<\/div>").appendTo(this.menuWrapper);this.createMenu=this.menuWrapper.find(".menu-create-table");this.editMenu=this.menuWrapper.find(".menu-edit-table");t=this.createTable(6,6).appendTo(this.createMenu);this.createMenu.on("mouseenter","td, th",function(i){return function(r){var e,u,f,o;return i.createMenu.find("td, th").removeClass("selected"),e=n(r.currentTarget),u=e.parent(),o=u.find("td, th").index(e)+1,f=u.prevAll("tr").addBack(),u.parent().is("tbody")&&(f=f.add(t.find("thead tr"))),f.find("td:lt("+o+"), th:lt("+o+")").addClass("selected")}}(this));this.createMenu.on("mouseleave",function(t){return n(t.currentTarget).find("td, th").removeClass("selected")});return this.createMenu.on("mousedown","td, th",function(i){return function(r){var u,e,f,s,o;if(i.wrapper.removeClass("menu-on"),i.editor.inputManager.focused)return e=n(r.currentTarget),f=e.parent(),s=f.find("td").index(e)+1,o=f.prevAll("tr").length+1,f.parent().is("tbody")&&(o+=1),t=i.createTable(o,s,!0),u=i.editor.selection.blockNodes().last(),i.editor.util.isEmptyNode(u)?u.replaceWith(t):u.after(t),i.decorate(t),i.editor.selection.setRangeAtStartOf(t.find("th:first")),i.editor.trigger("valuechanged"),!1}}(this))},i.prototype.createTable=function(t,i,r){var s,l,a,v,c,y,u,f,h,e,o;for(s=n("<table/>"),v=n("<thead/>").appendTo(s),l=n("<tbody/>").appendTo(s),h=u=0,e=t;0<=e?u<e:u>e;h=0<=e?++u:--u)for(c=n("<tr/>"),c.appendTo(h===0?v:l),y=f=0,o=i;0<=o?f<o:f>o;y=0<=o?++f:--f)a=n(h===0?"<th/>":"<td/>").appendTo(c),r&&a.append(this.editor.util.phBr);return s},i.prototype.refreshTableWidth=function(t){return setTimeout(function(){return function(){var i,r;return r=t.width(),i=t.find("col"),t.find("thead tr th").each(function(t,u){var f;return f=i.eq(t),f.attr("width",n(u).outerWidth()/r*100+"%")})}}(this),0)},i.prototype.setActive=function(n){return i.__super__.setActive.call(this,n),n?(this.createMenu.hide(),this.editMenu.show()):(this.createMenu.show(),this.editMenu.hide())},i.prototype._changeCellTag=function(t,i){return t.find("td, th").each(function(t,r){var u;return u=n(r),u.replaceWith("<"+i+">"+u.html()+"<\/"+i+">")})},i.prototype.deleteRow=function(n){var i,t,r;return t=n.parent("tr"),t.closest("table").find("tr").length<1?this.deleteTable(n):(i=this._nextRow(t),i.length>0||(i=this._prevRow(t)),r=t.find("td, th").index(n),t.parent().is("thead")&&(i.appendTo(t.parent()),this._changeCellTag(i,"th")),t.remove(),this.editor.selection.setRangeAtEndOf(i.find("td, th").eq(r)))},i.prototype.insertRow=function(t,i){var u,h,r,s,o,c,l,f,e;for(i==null&&(i="after"),r=t.parent("tr"),h=r.closest("table"),o=0,h.find("tr").each(function(t,i){return o=Math.max(o,n(i).find("td").length)}),l=r.find("td, th").index(t),u=n("<tr/>"),s="td",i==="after"&&r.parent().is("thead")?r.parent().next("tbody").prepend(u):i==="before"&&r.parent().is("thead")?(r.before(u),r.parent().next("tbody").prepend(r),this._changeCellTag(r,"td"),s="th"):r[i](u),c=f=1,e=o;1<=e?f<=e:f>=e;c=1<=e?++f:--f)n("<"+s+"/>").append(this.editor.util.phBr).appendTo(u);return this.editor.selection.setRangeAtStartOf(u.find("td, th").eq(l))},i.prototype.deleteCol=function(t){var r,u,i,f,e,o;return i=t.parent("tr"),o=i.closest("table").find("tr").length<2,e=t.siblings("td, th").length<1,o&&e?this.deleteTable(t):(f=i.find("td, th").index(t),r=t.next("td, th"),r.length>0||(r=i.prev("td, th")),u=i.closest("table"),u.find("col").eq(f).remove(),u.find("tr").each(function(t,i){return n(i).find("td, th").eq(f).remove()}),this.refreshTableWidth(u),this.editor.selection.setRangeAtEndOf(r))},i.prototype.insertCol=function(t,i){var u,f,s,r,h,e,c,o;return i==null&&(i="after"),h=t.parent("tr"),e=h.find("td, th").index(t),r=t.closest("table"),u=r.find("col").eq(e),r.find("tr").each(function(t){return function(r,u){var f,o;return o=n(u).parent().is("thead")?"th":"td",f=n("<"+o+"/>").append(t.editor.util.phBr),n(u).find("td, th").eq(e)[i](f)}}(this)),f=n("<col/>"),u[i](f),c=r.width(),o=Math.max(parseFloat(u.attr("width"))/2,5e3/c),u.attr("width",o+"%"),f.attr("width",o+"%"),this.refreshTableWidth(r),s=i==="after"?t.next("td, th"):t.prev("td, th"),this.editor.selection.setRangeAtStartOf(s)},i.prototype.deleteTable=function(n){var t,i;return i=n.closest(".simditor-table"),t=i.next("p"),i.remove(),t.length>0?this.editor.selection.setRangeAtStartOf(t):void 0},i.prototype.command=function(n){var t;if(t=this.editor.selection.containerNode().closest("td, th"),t.length>0){if(n==="deleteRow")this.deleteRow(t);else if(n==="insertRowAbove")this.insertRow(t,"before");else if(n==="insertRowBelow")this.insertRow(t);else if(n==="deleteCol")this.deleteCol(t);else if(n==="insertColLeft")this.insertCol(t,"before");else if(n==="insertColRight")this.insertCol(t);else if(n==="deleteTable")this.deleteTable(t);else return;return this.editor.trigger("valuechanged")}},i}(e),f.Toolbar.addButton(vt),at=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return u(i,t),i.prototype.name="strikethrough",i.prototype.icon="strikethrough",i.prototype.htmlTag="strike",i.prototype.disableTag="pre",i.prototype._activeStatus=function(){var n;return n=document.queryCommandState("strikethrough")===!0,this.setActive(n),this.active},i.prototype.command=function(){return document.execCommand("strikethrough"),this.editor.util.support.oninput||this.editor.trigger("valuechanged"),n(document).trigger("selectionchange")},i}(e),f.Toolbar.addButton(at),l=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return u(t,n),t.prototype.name="alignment",t.prototype.icon="align-left",t.prototype.htmlTag="p, h1, h2, h3, h4, td, th",t.prototype._init=function(){return this.menu=[{name:"left",text:this._t("alignLeft"),icon:"align-left",param:"left"},{name:"center",text:this._t("alignCenter"),icon:"align-center",param:"center"},{name:"right",text:this._t("alignRight"),icon:"align-right",param:"right"}],t.__super__._init.call(this)},t.prototype.setActive=function(n,i){return i==null&&(i="left"),i!=="left"&&i!=="center"&&i!=="right"&&(i="left"),i==="left"?t.__super__.setActive.call(this,!1):t.__super__.setActive.call(this,n),this.el.removeClass("align-left align-center align-right"),n&&this.el.addClass("align-"+i),this.setIcon("align-"+i),this.menuEl.find(".menu-item").show().end().find(".menu-item-"+i).hide()},t.prototype._status=function(){return this.nodes=this.editor.selection.nodes().filter(this.htmlTag),this.nodes.length<1?(this.setDisabled(!0),this.setActive(!1)):(this.setDisabled(!1),this.setActive(!0,this.nodes.first().css("text-align")))},t.prototype.command=function(n){if(n!=="left"&&n!=="center"&&n!=="right")throw new Error("simditor alignment button: invalid align "+n);return this.nodes.css({"text-align":n==="left"?"":n}),this.editor.trigger("valuechanged"),this.editor.inputManager.throttledSelectionChanged()},t}(e),f.Toolbar.addButton(l),f});
/*!
 *   Administrator Bulletin Page JavaScript v1.0.0
 *   Author: Danvic712
 */
$(function(){$(".date-picker").datepicker({autoclose:!0,todayHighlight:!0,language:"zh-CN",format:"yyyy-mm-dd"});var n=new Simditor({textarea:$("#detail"),toolbar:["title","bold","italic","fontScale","color","ol","ul","table","link","hr","indent","outdent","alignment",]})});