/*!
 *   Administrator Building Page JavaScript v1.0.0
 *   Author: Danvic712
 */
$.dataTableSetting={bSort:!1,serverSide:!0,sServerMethod:"POST",bDeferRender:!0,sScrollXInner:"100%",bLengthChange:!1,bFilter:!1,bStateSave:!0,bProcessing:!0,iDisplayLength:15,deferRender:!0,oLanguage:{sLengthMenu:"每页显示 _MENU_ 条记录",sZeroRecords:"对不起，没有匹配的数据",sInfo:"第 _START_ - _END_ 条 / 共 _TOTAL_ 条数据",sInfoEmpty:"没有匹配的数据",sInfoFiltered:"(数据表中共 _MAX_ 条记录)",sProcessing:"正在加载中...",sSearch:"全文搜索：",oPaginate:{sFirst:"第一页",sPrevious:" 上一页 ",sNext:" 下一页 ",sLast:" 最后一页 "}},paging:!0,processing:!0,columnDefs:[{targets:7,data:null,render:function(n){return'<a id="edit" class="btn btn-xs btn-link" data-id='+n.id+" data-name="+n.name+" data-floor="+n.floor+" data-type="+n.typeStr+" data-enable="+n.isEnabledStr+'>编辑<\/a><a id="delete" class="btn btn-xs btn-link" data-id='+n.id+">删除<\/a>"}}],columns:[{data:"id"},{data:"name"},{data:"floor"},{data:"typeStr"},{data:"createdName"},{data:"dateTime"},{data:"isEnabledStr"}],ajax:function(n,t){var i={};i.Limit=n.length;i.Start=n.start;i.Page=n.start/n.length+1;i.SId=$("#code").val();i.SType=$("#type").val();i.SEnable=$("#enable").val();$.ajax({type:"POST",url:"/Administrator/Dormitory/SearchBuilding",cache:!1,data:{search:JSON.stringify(i)},dataType:"json",success:function(i){var r={};r.draw=n.draw;r.recordsTotal=i.total;r.recordsFiltered=i.total;r.data=i.data;t(r)},error:function(n){console.log(n.responseText)}})}};$(function(){var n=$("#building-table").dataTable($.dataTableSetting);$(document).on("click","#add",function(){if($("#edit_name").val()==="")return bootbox.dialog({message:"请输入寝室楼名称"}),!1;if($("#edit_floor").val()==="")return bootbox.dialog({message:"请输入寝室楼总楼层"}),!1;if($("#edit_type").val()==="0")return bootbox.dialog({message:"请选择寝室楼类型"}),!1;var n={};n.Id=$("#edit_id").val();n.Name=$("#edit_name").val();n.Floor=$("#edit_floor").val();n.Type=$("#edit_type").val();n.IsEnabled=$("#edit_enable").val();$.ajax({url:"/Administrator/Dormitory/EditBuilding",type:"POST",dataType:"Json",data:n,success:function(n){n.msg!==undefined&&(bootbox.dialog({message:n.msg}),n.success&&setTimeout(function(){window.location.href="/Administrator/Dormitory/Building"},2e3))},error:function(n){console.log(n)}})});$(document).on("click","#search",function(){n.fnDestroy(!1);n=$("#building-table").dataTable($.dataTableSetting)});$(document).on("click","#edit",function(){$("#edit_id").val($(this).attr("data-id"));$("#edit_name").val($(this).attr("data-name"));$("#edit_floor").val($(this).attr("data-floor"));$("#edit_type option:contains("+$(this).attr("data-type")+")").prop("selected",!0);$("#edit_enable option:contains("+$(this).attr("data-enable")+")").prop("selected",!0);$("#myModal").modal()});$(document).on("click","#delete",function(){var n=$(this).attr("data-id");window.bootbox.confirm({message:'宿舍楼编号：<b class="text-red">'+n+"<\/b>，确定删除该宿舍楼数据吗？",buttons:{confirm:{label:"确定",className:"btn btn-success btn-flat"},cancel:{label:"取消",className:"btn btn-default btn-flat"}},callback:function(t){t&&$.ajax({url:"/Administrator/Dormitory/DeleteBuilding",type:"POST",dataType:"Json",data:{id:n},success:function(n){window.bootbox.alert({message:n.msg,buttons:{ok:{label:"确定",className:"btn bg-olive btn-flat margin"}},callback:function(){window.location="/Administrator/Dormitory/Building"}})},error:function(n){console.log(n)}})}})})});