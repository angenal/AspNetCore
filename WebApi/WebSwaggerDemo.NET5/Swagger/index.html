<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>%(DocumentTitle)</title>
    <!--<link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700|Source+Code+Pro:300,600|Titillium+Web:400,600,700" rel="stylesheet">-->
    <link rel="stylesheet" type="text/css" href="./swagger-ui.css">
    <link rel="icon" type="image/png" href="./favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="./favicon-16x16.png" sizes="16x16" />
    <style>html { box-sizing: border-box; overflow: auto; overflow-y: scroll; } *, *:before, *:after { box-sizing: inherit; } body { margin: 0; background: #fafafa; }</style>
    %(HeadContent)
</head>
<body>
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="position:absolute;width:0;height:0">
        <defs>
            <symbol viewBox="0 0 20 20" id="unlocked">
                <path d="M15.8 8H14V5.6C14 2.703 12.665 1 10 1 7.334 1 6 2.703 6 5.6V6h2v-.801C8 3.754 8.797 3 10 3c1.203 0 2 .754 2 2.199V8H4c-.553 0-1 .646-1 1.199V17c0 .549.428 1.139.951 1.307l1.197.387C5.672 18.861 6.55 19 7.1 19h5.8c.549 0 1.428-.139 1.951-.307l1.196-.387c.524-.167.953-.757.953-1.306V9.199C17 8.646 16.352 8 15.8 8z"></path>
            </symbol>

            <symbol viewBox="0 0 20 20" id="locked">
                <path d="M15.8 8H14V5.6C14 2.703 12.665 1 10 1 7.334 1 6 2.703 6 5.6V8H4c-.553 0-1 .646-1 1.199V17c0 .549.428 1.139.951 1.307l1.197.387C5.672 18.861 6.55 19 7.1 19h5.8c.549 0 1.428-.139 1.951-.307l1.196-.387c.524-.167.953-.757.953-1.306V9.199C17 8.646 16.352 8 15.8 8zM12 8H8V5.199C8 3.754 8.797 3 10 3c1.203 0 2 .754 2 2.199V8z" />
            </symbol>

            <symbol viewBox="0 0 20 20" id="close">
                <path d="M14.348 14.849c-.469.469-1.229.469-1.697 0L10 11.819l-2.651 3.029c-.469.469-1.229.469-1.697 0-.469-.469-.469-1.229 0-1.697l2.758-3.15-2.759-3.152c-.469-.469-.469-1.228 0-1.697.469-.469 1.228-.469 1.697 0L10 8.183l2.651-3.031c.469-.469 1.228-.469 1.697 0 .469.469.469 1.229 0 1.697l-2.758 3.152 2.758 3.15c.469.469.469 1.229 0 1.698z" />
            </symbol>

            <symbol viewBox="0 0 20 20" id="large-arrow">
                <path d="M13.25 10L6.109 2.58c-.268-.27-.268-.707 0-.979.268-.27.701-.27.969 0l7.83 7.908c.268.271.268.709 0 .979l-7.83 7.908c-.268.271-.701.27-.969 0-.268-.269-.268-.707 0-.979L13.25 10z" />
            </symbol>

            <symbol viewBox="0 0 20 20" id="large-arrow-down">
                <path d="M17.418 6.109c.272-.268.709-.268.979 0s.271.701 0 .969l-7.908 7.83c-.27.268-.707.268-.979 0l-7.908-7.83c-.27-.268-.27-.701 0-.969.271-.268.709-.268.979 0L10 13.25l7.418-7.141z" />
            </symbol>


            <symbol viewBox="0 0 24 24" id="jump-to">
                <path d="M19 7v4H5.83l3.58-3.59L8 6l-6 6 6 6 1.41-1.41L5.83 13H21V7z" />
            </symbol>

            <symbol viewBox="0 0 24 24" id="expand">
                <path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z" />
            </symbol>

        </defs>
    </svg>

    <div id="swagger-ui"></div>

    <script>if (window.navigator.userAgent.indexOf("Edge") > -1) window.fetch = undefined;</script>
    <script src="./swagger-ui-bundle.js"></script>
    <script src="./swagger-ui-standalone-preset.js"></script>
    <script>
        window.onload = function () {
            var configObject = JSON.parse('%(ConfigObject)');
            var oauthConfigObject = JSON.parse('%(OAuthConfigObject)');
            // Apply mandatory parameters
            configObject.dom_id = '#swagger-ui';
            configObject.presets = [SwaggerUIBundle.presets.apis, SwaggerUIStandalonePreset];
            configObject.layout = 'StandaloneLayout';
            configObject.urls.forEach(function (item) {
                if (item.url.startsWith('http') || item.url.startsWith('/')) return;
                item.url = location.href.replace('index.html', item.url).split('#')[0];
            });
            //if (!configObject.hasOwnProperty('validatorUrl')) configObject.validatorUrl = null;
            if (!configObject.hasOwnProperty('oauth2RedirectUrl')) {
                //configObject.oauth2RedirectUrl = window.location + 'oauth2-redirect.html'; // use the built-in default
                configObject.oauth2RedirectUrl = location.href.replace('index.html', 'oauth2-redirect.html');
            }
            // Init Token or Cookie
            initTokenCookiesStorage(configObject);
            // End Swagger UI call region
            window.swagger_ui = SwaggerUIBundle(configObject);
            // Apply OAuth config
            swagger_ui.initOAuth(oauthConfigObject);
            //console.log('ui', ui);
            custom_translate(configObject);
        };

        function custom_translate(configObject) {
            $('.swagger-ui .topbar a').attr('target', 'self').attr('href', location.href);
            $('.swagger-ui .topbar .download-url-wrapper .select-label span').text(resource_globalization.SelectDefinition);
            if (configObject.customAuth && configObject.logoutUrl) {
                console.log('Init Authorize Exit button');
                var btn = document.createElement('button');
                btn.className = 'btn ';
                btn.innerText = resource_globalization.Logout;
                btn.onclick = function () { location.href = configObject.logoutUrl; };
                document.getElementsByClassName('topbar-wrapper')[0].appendChild(btn);
            }
            var filterl = [], filterf = function () {
                filterl = $('.filter-container');
                if (filterl.length == 0) return setTimeout(filterf, 50);
                filterl.parent().addClass('wrapper');
                filterl.find('.operation-filter-input').attr('placeholder', '筛选 / 过滤');
                var fbutton = $('<button class="btn">展开</button>').click(function () {
                    var btn = $(this), txt = btn.text(), topen = txt == '展开';
                    btn.text(topen ? '折叠' : '展开');
                    $('.opblock-tag-section').each(function (i, v) {
                        var v1 = $(v), v2 = v1.hasClass('is-open');
                        if (topen) { if (!v2) v1.find('h4').trigger('click'); }
                        else { if (v2) v1.find('h4').trigger('click'); }
                    });
                });
                filterl.find('section.filter').append(fbutton);
            }; filterf();
        }

        function initTokenCookiesStorage(configObject) {
            if (!configObject.token_storage) {
                console.log('Init Authorize Use Cookie');
                configObject.requestInterceptor = (request) => {
                    var token = getCookieValue('CSRF-TOKEN');
                    if (token) request.headers.Authorization = 'Bearer ' + token;
                    var csrfTokenCookie = getCookieValue('X-CSRF-TOKEN');
                    if (csrfTokenCookie !== undefined && csrfTokenCookie !== null) request.headers['X-CSRF-TOKEN'] = csrfTokenCookie;
                    return request;
                };
                return;
            }
            console.log('init authorize local or session storage');
            configObject.token_storage.authorized = false;
            configObject.onComplete = () => {
                var tokenValue = getTokenStorage(configObject);
                if (!tokenValue) return;
                configObject.token_storage.authorized = true;
                swagger_ui.preauthorizeApiKey(configObject.token_storage.securityDefinition, tokenValue);
            };
            configObject.requestInterceptor = (request) => {
                request.headers.Authorization = getTokenStorage(configObject);
                return request;
            };
            addAuthorizeListener(configObject);
        }

        function addAuthorizeListener(configObject) {
            var authWrapper = document.querySelector('.scheme-container .auth-wrapper');
            if (authWrapper === undefined || authWrapper === null) return setTimeout(function () { addAuthorizeListener(configObject); }, 1000);
            var txtAuthorize = ['Authorize', resource_globalization.Authorize], txtLogout = ['Logout', resource_globalization.Logout];
            var scheme1 = "ApiKey", queryName1 = "apiKey";
            var scheme2 = "Bearer", queryName2 = "token";
            authWrapper.addEventListener('click', function (e) {
                if (e.type !== 'click') return;
                var btn = e.srcElement, tagName = 'BUTTON', clsName = 'authorized';
                if (btn.tagName !== tagName) {
                    if (btn.parentNode.tagName === tagName) btn = btn.parentNode;
                    else if (btn.parentNode.parentNode.tagName === tagName) btn = btn.parentNode.parentNode;
                }
                if (btn.tagName === tagName) {
                    var txt = btn.innerText, cls = btn.className;
                    if (!txt || !cls) return;
                    // authorize button
                    if (cls.indexOf('btn authorize') == 0) {
                        //console.log('click authorize button');
                        var formf = function () {
                            var forms = $('.scheme-container .auth-container');
                            if (forms.length == 0) setTimeout(formf, 20);
                            // scheme1 form
                            var form1 = forms.filter(function (i, v) { return v.innerText.indexOf(scheme1) == 0; });
                            if (form1.length == 1) {
                                var btnQ = form1.find('.modal-btn').eq(0);
                                var tokenValue = getTokenStorage(configObject), authorized = !!tokenValue;
                                configObject.token_storage.authorized = authorized;
                                btnQ.attr('scheme', scheme1).text(authorized ? txtLogout[1] : txtAuthorize[1]);
                                if (authorized) btnQ.addClass(clsName); else btnQ.removeClass(clsName);
                                form1.find('h4').html(form1.find('h4 code').html());
                                form1.find('h6').hide();
                            }
                            // scheme2 form
                            var form2 = forms.filter(function (i, v) { return v.innerText.indexOf(scheme2) == 0; });
                            if (form2.length == 1) {
                                //var btns = form2.find('.modal-btn'), el = form2.find('input');
                                //if (el.length == 1 && tokenValue) { el.val(tokenValue); btns.eq(0).trigger('click'); }
                                var btnQ = form2.find('.modal-btn').eq(0);
                                btnQ.attr('scheme', scheme2);
                                form2.find('h4').html(form2.find('h4 code').html());
                                form2.find('h6').hide();
                            }
                        }; formf();
                    }
                    // authorize form auth button
                    if (cls.indexOf('btn modal-btn') == 0) {
                        var btnQ = $(btn), scheme = btnQ.attr('scheme');
                        //console.log('click authorize form-button:', scheme);
                        // scheme1 form button
                        if (scheme === scheme1) {
                            var form1 = btnQ.parents('form');
                            if (txtAuthorize.indexOf(txt) != -1) {
                                var el = form1.find('input');
                                if (el.length == 0) return;
                                if ($.trim(el.val()) == '') return alert('输入内容不能为空');
                                configObject.token_storage.authorized = true;
                                var authfn = function () { btnQ.text(txtLogout[1]); btnQ.addClass(clsName); form1.find('h6').hide(); };
                                setTimeout(authfn, 10); setTimeout(authfn, 20);
                                setTokenStorage(configObject, el.val());
                            } else if (txtLogout.indexOf(txt) != -1) {
                                configObject.token_storage.authorized = false;
                                var authfn = function () { btnQ.text(txtAuthorize[1]); btnQ.removeClass(clsName); form1.find('h6').hide(); };
                                setTimeout(authfn, 10); setTimeout(authfn, 20);
                                removeTokenStorage(configObject);
                            }
                        }
                        // scheme2 form button
                        if (scheme === scheme2) {
                        }
                    }
                }
            }, false);
        }

        function getCookieValue(key) {
            var equalities = document.cookie.split('; ');
            for (var i = 0; i < equalities.length; i++) {
                if (!equalities[i]) continue;
                var splitted = equalities[i].split('=');
                if (splitted.length !== 2) continue;
                if (decodeURIComponent(splitted[0]) === key) return decodeURIComponent(splitted[1] || '');
            }
            return null;
        }

        function getTokenStorage(configObject) {
            var key = configObject.token_storage.securityDefinition;
            return configObject.token_storage.cacheType.toLowerCase().indexOf('local') == -1 ? sessionStorage.getItem(key) : localStorage.getItem(key);
        }

        function setTokenStorage(configObject, value) {
            var key = configObject.token_storage.securityDefinition;
            return configObject.token_storage.cacheType.toLowerCase().indexOf('local') == -1 ? sessionStorage.setItem(key, value) : localStorage.setItem(key, value);
        }

        function removeTokenStorage(configObject) {
            var key = configObject.token_storage.securityDefinition;
            localStorage.removeItem(key); sessionStorage.removeItem(key);
        }
    </script>
</body>
</html>
