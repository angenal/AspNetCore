<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>%(DocumentTitle)</title>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700|Source+Code+Pro:300,600|Titillium+Web:400,600,700" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="./swagger-ui.css">
    <link rel="icon" type="image/png" href="./favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="./favicon-16x16.png" sizes="16x16" />
    <style>
        html {
            box-sizing: border-box;
            overflow: auto;
            overflow-y: scroll;
        }

        *,
        *:before,
        *:after {
            box-sizing: inherit;
        }

        body {
            margin: 0;
            background: #fafafa;
        }

        .swagger-ui .opblock-body select {
            min-width: 6em;
        }

        .swagger-ui table tbody tr td:first-of-type {
            min-width: 10em;
        }

        .swagger-ui .parameters-col_description input[type=number] {
            font-weight: bold;
            width: 100%;
            max-width: 340px;
            min-width: 100px;
            margin: 5px 0;
            padding: 8px 10px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            background: #fff;
        }
    </style>
    %(HeadContent)
</head>
<body>
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="position:absolute;width:0;height:0">
        <defs>
            <symbol viewBox="0 0 20 20" id="unlocked">
                <path d="M15.8 8H14V5.6C14 2.703 12.665 1 10 1 7.334 1 6 2.703 6 5.6V6h2v-.801C8 3.754 8.797 3 10 3c1.203 0 2 .754 2 2.199V8H4c-.553 0-1 .646-1 1.199V17c0 .549.428 1.139.951 1.307l1.197.387C5.672 18.861 6.55 19 7.1 19h5.8c.549 0 1.428-.139 1.951-.307l1.196-.387c.524-.167.953-.757.953-1.306V9.199C17 8.646 16.352 8 15.8 8z"></path>
            </symbol>

            <symbol viewBox="0 0 20 20" id="locked">
                <path d="M15.8 8H14V5.6C14 2.703 12.665 1 10 1 7.334 1 6 2.703 6 5.6V8H4c-.553 0-1 .646-1 1.199V17c0 .549.428 1.139.951 1.307l1.197.387C5.672 18.861 6.55 19 7.1 19h5.8c.549 0 1.428-.139 1.951-.307l1.196-.387c.524-.167.953-.757.953-1.306V9.199C17 8.646 16.352 8 15.8 8zM12 8H8V5.199C8 3.754 8.797 3 10 3c1.203 0 2 .754 2 2.199V8z" />
            </symbol>

            <symbol viewBox="0 0 20 20" id="close">
                <path d="M14.348 14.849c-.469.469-1.229.469-1.697 0L10 11.819l-2.651 3.029c-.469.469-1.229.469-1.697 0-.469-.469-.469-1.229 0-1.697l2.758-3.15-2.759-3.152c-.469-.469-.469-1.228 0-1.697.469-.469 1.228-.469 1.697 0L10 8.183l2.651-3.031c.469-.469 1.228-.469 1.697 0 .469.469.469 1.229 0 1.697l-2.758 3.152 2.758 3.15c.469.469.469 1.229 0 1.698z" />
            </symbol>

            <symbol viewBox="0 0 20 20" id="large-arrow">
                <path d="M13.25 10L6.109 2.58c-.268-.27-.268-.707 0-.979.268-.27.701-.27.969 0l7.83 7.908c.268.271.268.709 0 .979l-7.83 7.908c-.268.271-.701.27-.969 0-.268-.269-.268-.707 0-.979L13.25 10z" />
            </symbol>

            <symbol viewBox="0 0 20 20" id="large-arrow-down">
                <path d="M17.418 6.109c.272-.268.709-.268.979 0s.271.701 0 .969l-7.908 7.83c-.27.268-.707.268-.979 0l-7.908-7.83c-.27-.268-.27-.701 0-.969.271-.268.709-.268.979 0L10 13.25l7.418-7.141z" />
            </symbol>


            <symbol viewBox="0 0 24 24" id="jump-to">
                <path d="M19 7v4H5.83l3.58-3.59L8 6l-6 6 6 6 1.41-1.41L5.83 13H21V7z" />
            </symbol>

            <symbol viewBox="0 0 24 24" id="expand">
                <path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z" />
            </symbol>

        </defs>
    </svg>

    <div id="swagger-ui"></div>

    <script>if (window.navigator.userAgent.indexOf("Edge") > -1) window.fetch = undefined;</script>
    <script src="./swagger-ui-bundle.js"></script>
    <script src="./swagger-ui-standalone-preset.js"></script>
    <script>
        window.onload = function () {
            var configObject = JSON.parse('%(ConfigObject)');
            var oauthConfigObject = JSON.parse('%(OAuthConfigObject)');
            // Apply mandatory parameters
            configObject.dom_id = '#swagger-ui';
            configObject.presets = [SwaggerUIBundle.presets.apis, SwaggerUIStandalonePreset];
            configObject.layout = 'StandaloneLayout';
            configObject.urls.forEach(function (item) {
                if (item.url.startsWith('http') || item.url.startsWith('/')) return;
                item.url = window.location.href.replace('index.html', item.url).split('#')[0];
            });
            //if (!configObject.hasOwnProperty('validatorUrl')) configObject.validatorUrl = null;
            if (!configObject.hasOwnProperty('oauth2RedirectUrl')) {
                //configObject.oauth2RedirectUrl = window.location + 'oauth2-redirect.html'; // use the built-in default
                configObject.oauth2RedirectUrl = window.location.href.replace('index.html', 'oauth2-redirect.html');
            }
            // Init Token or Cookie
            initTokenCookiesStorage(configObject);
            // End Swagger UI call region
            window.swagger_ui = SwaggerUIBundle(configObject);
            // Apply OAuth config
            swagger_ui.initOAuth(oauthConfigObject);
            //console.log('ui', ui);
            custom_translate(configObject);
        };

        function custom_translate(configObject) {
            //document.getElementsByTagName('span')[0].innerText = document.getElementsByTagName('span')[0].innerText.replace('swagger', '接口文档');
            //document.getElementsByTagName('span')[1].innerText = document.getElementsByTagName('span')[1].innerText.replace('Select a definition', resource_globalization.SelectDefinition);
            if (configObject.customAuth && configObject.logoutUrl) {
                console.log('初始化 Authorize 退出 button');
                var btn = document.createElement('button');
                btn.className = 'btn ';
                btn.innerText = resource_globalization.Logout;
                btn.onclick = function () { location.href = configObject.logoutUrl; };
                document.getElementsByClassName('topbar-wrapper')[0].appendChild(btn);
            }
        }

        function initTokenCookiesStorage(configObject) {
            if (!configObject.token_storage) {
                console.log('初始化 Authorize 使用 Cookie');
                configObject.requestInterceptor = (request) => {
                    var token = getCookieValue('CSRF-TOKEN');
                    if (token) request.headers.Authorization = 'Bearer ' + token;
                    var csrfTokenCookie = getCookieValue('X-CSRF-TOKEN');
                    if (csrfTokenCookie !== undefined && csrfTokenCookie !== null) request.headers['X-CSRF-TOKEN'] = csrfTokenCookie;
                    return request;
                };
                return;
            }
            console.log('初始化 Authorize 使用 Storage');
            configObject.onComplete = () => {
                var tokenValue = getTokenStorage(configObject);
                if (tokenValue) swagger_ui.preauthorizeApiKey(configObject.token_storage.securityDefinition, tokenValue);
            };
            configObject.requestInterceptor = (request) => {
                request.headers.Authorization = getTokenStorage(configObject);
                return request;
            };
            addAuthorizeListener(configObject);
        }

        function addAuthorizeListener(configObject) {
            var authWrapper = document.querySelector(".scheme-container .auth-wrapper");
            if (authWrapper === undefined || authWrapper === null) return setTimeout(function () { addAuthorizeListener(configObject); }, 1000);
            var forms = null, txt1 = ['Authorize', resource_globalization.Authorize], txt2 = ["Logout", resource_globalization.Logout];
            var scheme1 = "ApiKey", queryName1 = "apiKey";
            var scheme2 = "Bearer", queryName2 = "token";
            authWrapper.addEventListener("click", function (e) {
                if (e.type === "click" && e.srcElement.tagName === "BUTTON") {
                    var btn0 = e.srcElement, txt = btn0.innerText, cls = btn0.className;
                    if (!cls) return false;
                    // btn authorize locked
                    if (cls.indexOf('authorize') != -1 && forms == null) {
                        forms = $('.scheme-container .auth-container');
                        console.log('forms.length:', forms.length);
                        if (forms.length == 0) setTimeout(function () {
                            forms = $('.scheme-container .auth-container');
                            console.log('forms.length:', forms.length);
                            // scheme1 form
                            var formApiKey = forms.filter(function (i, v) { return v.innerText.indexOf(scheme1) == 0; });
                            if (formApiKey.length == 1) {
                                console.log('scheme1 form:', scheme1);
                                var el = formApiKey.find('input'), bts = formApiKey.find('button.auth');
                                //if (el.length == 1 && tokenValue) { el.val(tokenValue); bts.eq(0).trigger('click'); }
                                bts.eq(0).addClass(scheme1).text(el.length == 0 ? txt2[1] : txt1[1]);
                            }
                            // scheme2 form
                            var formBearer = forms.filter(function (i, v) { return v.innerText.indexOf(scheme2) == 0; });
                            if (formBearer.length == 1) { }
                        }, 500);
                    }
                    // btn modal-btn auth button
                    if (cls.indexOf('auth') != -1) {
                        var form0 = $(btn0).parent().parent();
                        // scheme1 button
                        if (cls.indexOf(scheme1) != -1) {
                            if (txt1.indexOf(txt) != -1) {
                                var el = form0.find("input");
                                if (el.length == 0) return;
                                setTokenStorage(configObject, el.val());
                                btn0.innerText = resource_globalization.Logout;
                            } else if (txt2.indexOf(txt) != -1) {
                                removeTokenStorage(configObject);
                                btn0.innerText = resource_globalization.Authorize;
                            }
                        }
                        // scheme2 button
                        if (cls.indexOf(scheme2) != -1) {
                        }
                    }
                }
            }, false);
        }

        function getCookieValue(key) {
            var equalities = document.cookie.split('; ');
            for (var i = 0; i < equalities.length; i++) {
                if (!equalities[i]) continue;
                var splitted = equalities[i].split('=');
                if (splitted.length !== 2) continue;
                if (decodeURIComponent(splitted[0]) === key) return decodeURIComponent(splitted[1] || '');
            }
            return null;
        }

        function getTokenStorage(configObject) {
            var key = configObject.token_storage.securityDefinition;
            return configObject.token_storage.cacheType.toLowerCase().indexOf('local') == -1 ? sessionStorage.getItem(key) : localStorage.getItem(key);
        }

        function setTokenStorage(configObject, value) {
            var key = configObject.token_storage.securityDefinition;
            return configObject.token_storage.cacheType.toLowerCase().indexOf('local') == -1 ? sessionStorage.setItem(key, value) : localStorage.setItem(key, value);
        }

        function removeTokenStorage(configObject) {
            var key = configObject.token_storage.securityDefinition;
            localStorage.removeItem(key); sessionStorage.removeItem(key);
        }
    </script>
</body>
</html>
